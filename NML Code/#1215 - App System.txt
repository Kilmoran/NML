1. Jutsu Apps
	* +app/jutsu - viewer
	* +app/jutsu submit
	* +app/jutsu - editor
	* Functions and Lists

2. Jutsu Apps - Staff Side
	* +JutsuApps
	* +JutsuApps/view
	* +JutsuApps/alter
	* +JutsuApps/Approve
	* +JutsuApps/Deny

3. TF Apps
	* +app/tf create
	* +app/tf - Viewer
	* +app/tf - Editor
	* +App/TF Submit

4. TF Apps - Staff Side
	* +TFApps
	* +TFApps/view
	* +TFApps/alter
	* +TFApps/Approve
	* +TFApps/Deny

5. Clan TFs
	* +ClanTF
	* Lists

6. Auto Purchases
	* Stats
	* Proficiency
	* Mastery
	* RP Skills
	* Specialty Slots
	* Expertise Slots
	* TF Ranks

7. Teaching
8. TC Stuff
9. Etc Functions

-------------------------------[ Jutsu Apps ]--------------------------------

&CMD`JUTSUAPP-VIEW #1215=$+app/jutsu:@pemit %#=[u(#1215/func`JutsuApp-View, %#)]

	&FUNC`JUTSUAPP-VIEW #1215=[printf($^78:[ansi(hb, -=)]:s, %[ [ansi(hw, [name(%0)]'s Jutsu App)] %])]%r[printf($14-&s $22&s $1&s $14-&s $22&s,[ansi(hc, Prefix, n, :, hc, %rAccess, n, :, hc, %rCategory, n, :, hc, %rMethod, n, :, hc, %rRank, n, :, hc, )], [edit([elementsmux([get(%0/dat`JutsuApp)], 11 2 3 6 8, |)], |, %r)], |%r|%r|%r|%r|, [ansi(hc, Name, n, :, hc, %rAlt Name, n, :, hc, %rArchetype, n, :, hc, %rType, n, :)], [edit([elementsmux([get(%0/dat`JutsuApp)], 1 10 4 5, |)], |, %r)])]%r%r[printf($-78"|"s, [ansi(hc, Special Actions)]: [elist([elementsmux([get(%0/dat`JutsuApp)], 7, |)],,~,,,[ansi(y, %0)])])]%r%r[ansi(hc, Description)]: [elementsmux([get(%0/dat`JutsuApp)], 9, |)]%r%r[ansi(hc, Notes)]: [elementsmux([get(%0/dat`JutsuApp)], 12, |)]%r[printf($^78:-:s, %[ Resource Data %])]%r[printf($18-&s $18&s $1&s $18-&s $18&s, [ansi(hc, Creator, n, :, hc, %rXP, n, :, hc, %rKP, n, :)],[name(%0)]%r[u(fn`jutsuXPCost_discounted, %0)]%r[u(fn`jutsuKPCost_discounted, %0)],|%r|%r|, [ansi(hc, Stamina, n, :, hc, %rChakra, n, :, hc, %rAP, n, :)], [u(fn`jutsuStaminaCost, %0)]%r[u(fn`jutsuChakraCost, %0)]%r[u(fn`jutsuAPCost, %0)])]%r[printf($^78:[ansi(hb, -=)]:s, %[ [ansi(hw, End Jutsu App)] %])]

&CMD`JUTSUAPP #1215=$+app/jutsu *=*:@break [match([v(list`JutsuApps)], %#)]={@pemit %#=[prompt(game)] You already have a Jutsu Application in the queue. Please wait up to 48 hours after submission before contacting staff.}; @assert [setr(0, [match([v(list`Jutsu-AppFields)], %0*, |)])]={@pemit %#=[prompt(app)] [ansi(hy, %0)] is not a valid Jutsu App Field.}; @assert [t(%1)]={@pemit %#={[prompt(app)] The [elementsmux([v(list`jutsu-appfields)], %q0, |)] field has been reset.}; @set %#=dat`jutsuapp:[replace([get(%#/dat`jutsuapp)], %q0,,|)]}; @include #1215/fn`[elements([v(list`jutsu-appFuncs)], %q0, |)]=%#, [trim([securex(%1, a %(%)%%%,;)])], %#

@@ Jutsu App Submit Command TODO!!!

	&LIST`JUTSU-APPFIELDS #1215=Name|Access|Category|Archetype|Type|Method|Special Actions|Rank|Description|Alt Name|Prefix|Notes

	&LIST`JUTSU-APPFUNCS #1215=Name|Access|Category|Archetype|Type|Method|SpecAdd|Rank|Desc|Alt|Prefix|Notes

	&LIST`JUTSU-APPNUMS #1215=1 2 3 4 5 6 7 8 9 10 11 12

	&LIST`JUTSU-SQL #1215=Author Category Archetype Type Method Special Range Rank

	&LIST`JUTSU-SQLCOLS #1215=2 3 4 5 6 7 8 9

&FN`NAME #1215=@assert [lte([strlen(%1)], 22)]={@pemit %2=[prompt(app)] The Jutsu's name is too long. It must be less than 22 characters long, and it is currently [ansi(r, [strlen(%1)])].}; @break [hasattr(%0/dat`JutsuAttributes`[edit(%1, %b, -)])]={@pemit %2=[prompt(app)] This character already has a jutsu by that name.}; @set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 1, %1, |)]; @pemit %2=[prompt(app)] You have set [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] to be the Jutsu's name.

&FN`ACCESS #1215=@assert match([v(list`access)], %1)={@pemit %2=[prompt(App)] [ansi(hy, %1)] is not a proper Access selection try [elist([v(list`access)], or,,,,[ansi(y, %0)])] instead.}; @break [and([strmatch(%1, clan)], [strmatch([get(%0/dat`clan)], None)])]={@pemit %2=[prompt(app)] You do not have a Clan. Please select [elist([remove([v(list`access)], Clan)], or,,,,[ansi(y, %0)])] instead.}; @set %0=dat`jutsuapp:[replace(get(%0/dat`jutsuapp),2,[if([strmatch(%1, clan)], [get(%0/dat`clan)], [grab([v(list`access)], %1)])],|)]; @pemit %2=[prompt(App)] The Access selection of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 2, |)])].

	&LIST`ACCESS #1215=General Clan Hiden

&FN`CATEGORY #1215=@assert [t([setr(0, [grab([v(list`category)], %1*)])])]={@pemit %2=[prompt(app)] Please select either [elist([v(list`category)],or,,,,[ansi(y, %0)])].}; @assert [lor([iter([v(list`cat-%q0)], [match([get(%0/dat`expertiseList)], ##*, |)], |)])]={@pemit %2=[prompt(app)] The specialties possessed do not allow for the [ansi(y, %q0)] Category on this jutsu.}; @set %0=dat`jutsuApp:[replace([get(%0/dat`JutsuApp)], 4 5 7,,|)]; @set %0=dat`JutsuApp:[replace([get(%0/dat`JutsuApp)], 3, %q0, |)]; @pemit %2=[prompt(App)] The Category of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 3, |)])].

	&LIST`CATEGORY #1215=Taijutsu Ninjutsu

		&LIST`CAT-TAIJUTSU #1215=Martial Arts|Armament

		&LIST`CAT-NINJUTSU #1215=Nature Transformation:|Combination Element:|Seal Manifestation|Calligraphy Conjuration

&FN`ARCHETYPE #1215=@assert [t([setr(0, [elementsmux([get(%0/dat`jutsuapp)], 3, |)])])]={@pemit %2=[prompt(app)] You must select a category for the jutsu with [formathelp(+app/jutsu Category=<Category>)] first.}; @assert [t([setr(1, [grab([v(list`archetypes)], %1*, |)])])]={@pemit %2=[prompt(app)] That is not a valid Archetype. Try [elist([v(list`archetypes)],or,|,,,[ansi(y, %0)])].}; @assert [match([v(list`archetypes`%q0)], %q1, |)]={@pemit %2=[prompt(app)] [ansi(y, %q1)] is not an appropriate Archetype for the current Category. Please choose from [elist([v(list`archetypes`%q0)],or,|,,,[ansi(y, %0)])]}; @assert [u(chk`archeSpecs`[edit(%q1, %b, -)], %0)]={@pemit %2=[prompt(app)] The specialties do not allow for the [ansi(y, %q1)] Archetype to be applied.}; @set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuApp)], 4, %q1, |)]; @set %0=dat`jutsuApp:[replace([get(%0/dat`JutsuApp)], 5 7,,|)]; @pemit %2=[prompt(App)] The Archetype of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 4, |)])].

@@ Archetype Lists - Category Limits:

	&LIST`ARCHETYPES #1215=Taijutsu|Bukijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu|Ninjutsu|Seals|Calligraphy|Nintaijutsu|Combination

	&LIST`ARCHETYPES`TAIJUTSU #1215=Taijutsu|Bukijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu

	&LIST`ARCHETYPES`NINJUTSU #1215=Ninjutsu|Combination|Seals|Calligraphy|Nintaijutsu

	&LIST`ARCHETYPES`GENJUTSU #1215=Genjutsu|GenTaijutsu|GenBukijutsu

@@ Archetype Lists - Specialty Requirements:

	&CHK`ARCHESPECS`TAIJUTSU #1215=[match([get(%0/dat`ExpertiseList)], Martial Arts*, |)]

	&CHK`ARCHESPECS`BUKIJUTSU #1215=[match([get(%0/dat`ExpertiseList)], Armament*, |)]

	&CHK`ARCHESPECS`CHAKRA-FLOW-TAIJUTSU #1215=[and([match([get(%0/dat`ExpertiseList)], Martial Arts*, |)], [match([get(%0/dat`ExpertiseList)], Chakra Flow*, |)])]

	&CHK`ARCHESPECS`CHAKRA-FLOW-BUKIJUTSU #1215=[and([match([get(%0/dat`ExpertiseList)], Armament*, |)], [match([get(%0/dat`ExpertiseList)], Chakra Flow*, |)])]

	&CHK`ARCHESPECS`NINJUTSU #1215=[or([match([get(%0/dat`ExpertiseList)], Nature Transformation:*, |)], [match([get(%0/dat`ExpertiseList)], Combination Element:*, |)])]

	&CHK`ARCHESPECS`SEALS #1215=[match([get(%0/dat`ExpertiseList)], Seal Manifestation*, |)]

	&CHK`ARCHESPECS`CALLIGRAPHY #1215=[match([get(%0/dat`ExpertiseList)], Calligraphy Conjuration*, |)]

	&CHK`ARCHESPECS`NINTAIJUTSU #1215=[and([or([match([get(%0/dat`ExpertiseList)], Nature Transformation:*, |)], [match([get(%0/dat`ExpertiseList)], Combination Element:*, |)])], [match([get(%0/dat`ExpertiseList)], Chakra Flow*, |)], [match([get(%0/dat`ExpertiseList)], Shape Transformation*, |)], [match([get(%0/dat`ExpertiseList)], Martial Arts*, |)])]

	&CHK`ARCHESPECS`COMBINATION #1215=[match([get(%0/dat`ExpertiseList)], Combination Element*, |)]

	&CHK`ARCHESPECS`GENJUTSU #1215=[match([get(%0/dat`ExpertiseList)], Illusionary Tactics*, |)]

	&CHK`ARCHESPECS`GENTAIJUTSU #1215=[and([match([get(%0/dat`ExpertiseList)], Illusionary Tactics*, |)], [match([get(%0/dat`ExpertiseList)], Martial Arts*, |)])]

	&CHK`ARCHESPECS`GENBUKIJUTSU #1215=[and([match([get(%0/dat`ExpertiseList)], Illusionary Tactics*, |)], [match([get(%0/dat`ExpertiseList)], Armament*, |)])]

&FN`TYPE #1215=@assert [t([setr(0, [elementsmux([get(%0/dat`jutsuapp)], 4, |)])])]={@pemit %2=[prompt(app)] You must select an Archetype for this jutsu with [formathelp(+app/jutsu Archetype=<Archetype>)] first.}; @assert [t([setr(1, [grab([v(list`types)], %1)])])]={@pemit %2=[prompt(app)] Please choose a valid type: [elist([v(List`types)], or,,,,[ansi(y, %0)])].};@assert [match([v(list`type`[edit(%q0, %b, -)])], %q1)]={@pemit %2=[prompt(app)] Please choose a valid type for the given archetype: [elist([v(list`type`[edit(%q0, %b, -)])], or,,,, [ansi(y, %0)])]}; @break [or([and([match([v(list`type-elements)], %q1)], [!match([get(%0/dat`expertiseList)], Nature Transformation: %q1*, |)])], [and([match([v(list`type-combo)], %q1)], [!match([get(%0/dat`expertiseList)], %q0 Element:*, |)])])]={@pemit %2=[prompt(app)] This character does not have the required specialty to make this jutsu [ansi(y, %q1)] Type.}; @set %0=dat`JutsuApp:[replace(get(%0/dat`jutsuapp),5,%q1,|)]; @pemit %2=[prompt(App)] The Type of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 5, |)])].

@@ %q0 - Archetype ; %q1 - Type

	&LIST`TYPES #1215=Physical Yin Yang Fire Wind Earth Water Lightning Combination

		&LIST`TYPE`TAIJUTSU #1215=Physical

		&LIST`TYPE`BUKIJUTSU #1215=Physical

		&LIST`TYPE`CHAKRA-FLOW-TAIJUTSU #1215=Physical Yin Yang Fire Earth Water Lightning Wind

		&LIST`TYPE`CHAKRA-FLOW-BUKIJUTSU #1215=Physical Yin Yang Fire Earth Water Lightning Wind

		&LIST`TYPE`NINJUTSU #1215=Physical Yin Yang Fire Earth Water Lightning Wind

		&LIST`TYPE`SEALS #1215=Yin Yang Fire Earth Water Lightning Wind

		&LIST`TYPE`CALLIGRAPHY #1215=Physical Yin Yang Fire Earth Water Lightning Wind

		&LIST`TYPE`NINTAIJUTSU #1215=Yin Yang Fire Earth Water Lightning Wind Combination

		&LIST`TYPE`COMBINATION #1215=Combination

		&LIST`TYPE`TOTA #1215=Tota

		&LIST`TYPE-ELEMENTS #1215=Fire Water Lightning Yin Yang Earth Wind

		&LIST`TYPE-COMBO #1215=Combination

&FN`METHOD #1215=@assert [t([setr(0, [grab(Attack Defend, %1)])])]={@pemit %2=[prompt(app)] Please select either [elist(Attack Defend, or,,,,[ansi(y, %0)])] as a valid Method.}; @set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 6, %q0, |)]; @pemit %2=[prompt(App)] The Method of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 6, |)])].

&FN`RANK #1215=@assert [setr(0, [grab([u(#244/dat`ranks)], %1, |)])]={@pemit %2=[prompt(app)] That is not a valid rank. Please select [elist([u(#244/dat`ranks)], or, |,,,[ansi(y, %0)])].}; @set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 8, %q0, |)]; @pemit %2=[prompt(App)] The Rank of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 8, |)])].

&FN`DESC #1215=@set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 9, %1, |)]; @pemit %2=[prompt(App)] The Desc of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now: [ansi(c, [elementsmux([get(%0/dat`jutsuapp)], 9, |)])]

&FN`ALT #1215=@set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 10, %1, |)]; @pemit %2=[prompt(App)] The Alternative Name of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 10, |)])].

&FN`PREFIX #1215=@set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 11, [trim(%1,,:)]:, |)]; @pemit %2=[prompt(App)] The Prefix of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu is now [ansi(y, [elementsmux([get(%0/dat`jutsuapp)], 11, |)])]. Please be sure that the Prefix you have chosen is appropriate for the jutsu and the character's capabilities.

&FN`NOTES #1215=@set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 12, %1, |)]; @pemit %2=[prompt(App)] The Notes of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu are now [ansi(c, [elementsmux([get(%0/dat`jutsuapp)], 12, |)])]

&FN`SPECADD #1215=@assert [t([setr(0, [elementsmux([get(%0/dat`jutsuapp)], 6, |)])])]={@pemit %2=[prompt(app)] Please select a Method using [formathelp({+app/jutsu Method=<Attack|Defend>})]}; @eval [iter(%1, [if([strmatch(##, !*)], [setq(2, [r(2)] [grab([v(list`specs`%q0)], [after(##, !)], |)])], [setq(1, [r(1)] [grab([v(list`specs`%q0)], ##, |)])])])]; @assert [t(%q1 %q2)]={@pemit %2=[prompt(app)] Please select valid Special Actions. Possible selections (disregarding current specialties): [elist([setinter([v(list`specs`[edit([elementsmux([get(%0/dat`jutsuapp)], 4, |)], %b, -)])], [v(list`specs`%q0)], |)], or,|,,,[ansi(y, %0)])].}; @assert [land([iter(%q1, [if([match([get(%0/dat`expertiseList)], [v(list`specs`##)]*, |)],1, 0[setq(4, %q4 ##)])])])]={@pemit %2=[prompt(app)] This character does not have the specialties to apply the following special actions: %q4}; @assert [lor([iter(%q1, [if([or([match([u(#1215/list`specs`[edit([elementsmux([get(%0/dat`jutsuapp)], 4, |)], %b, -)])], ##, |)], [t([u(fn`SpecExceptions`##, %0)])])],1,0[setq(5, %q5 ##)])])])]={@pemit %2=[prompt(Game)] This app does not have the proper Archetype for the %q5 Special Action(s).}; @break [and([strmatch([elementsmux([get(%0/dat`jutsuapp)], 4, |)], Seals)], [gt([words([setr(3, [setinter([edit([u(list`specs`[edit([elementsmux([get(%0/dat`jutsuapp)], 4, |)], %b, -)])], |, ~)], [setunion([setdiff([elementsmux([get(%0/dat`jutsuapp)], 7, |)], [edit(%q2, %b, ~)], ~)], [edit(%q1, %b, ~)], ~)], ~)])], ~)], 1)])]={@pemit %2=[prompt(app)] A jutsu with the Seal Archetype may only have one Special Action.}; @set %0=dat`jutsuapp:[replace([get(%0/dat`jutsuapp)], 7, %q3, |)]; @pemit %2=[prompt(App)] The Special Actions of the [ansi(0xd0, [elementsmux([get(%0/dat`jutsuapp)], 1, |)])] jutsu are now: [elist([elementsmux([get(%0/dat`jutsuapp)], 7, |)], and,~,,,[ansi(y, %0)])].

@@ %q0 - Method ; %q1 - Specs to Add ; %q2 - Specs to Remove ; %q3 - Final list of Special Actions ; %q4 - Specs you can't add bc of Specialties ; %q5 - Specs you can't add bc of Archetype

@@ Special Actions - Exceptions:

	&FN`SPECEXCEPTIONS`DOT #1215=[and([strmatch([get(%0/dat`clan)], Yamata)], [strmatch([elementsmux([get(%0/dat`jutsuapp)], 4, |)], Taijutsu)])]

@@ Special Actions - Method:

	&LIST`SPECS`ATTACK #1215=Targeted|Powerful|Disrupt|Flurry|Barrage|Charge|Feint|DoT|Absorb|Drain|Counter|Clash|Collab

	&LIST`SPECS`DEFEND #1215=Turtle|Barrier|Reflection|Block|Evade|Avoid

@@ Special Actions - Specialty Requirements:

  	&LIST`SPECS`CHARGE #1215=Chakra Flow

  	&LIST`SPECS`DOT #1215=Attrition

  	&LIST`SPECS`DRAIN #1215=Chakra Drain

  	&LIST`SPECS`ABSORB #1215=Chakra Absorption

  	&LIST`SPECS`REFLECTION #1215=Reflection

  	&LIST`SPECS`FEINT #1215=Ambidexterity

  	&LIST`SPECS`TARGETED #1215=Targeted

  	&LIST`SPECS`POWERFUL #1215=Powerful

  	&LIST`SPECS`DISRUPT #1215=Disruption

  	&LIST`SPECS`FLURRY #1215=Onslaught

  	&LIST`SPECS`BARRAGE #1215=Onslaught

  	&LIST`SPECS`COUNTER #1215=Counter Offensive

  	&LIST`SPECS`CLASH #1215=Counter Offensive

  	&LIST`SPECS`COLLAB #1215=Synchronized Effort

  	&LIST`SPECS`TURTLE #1215=Fortification

  	&LIST`SPECS`BARRIER #1215=Barrier

  	&LIST`SPECS`BLOCK #1215=Fortification

  	&LIST`SPECS`EVADE #1215=Evasive Maneuvers

  	&LIST`SPECS`AVOID #1215=Evasive Maneuvers

@@ Special Actions - Archetype Limits:

	&LIST`SPECS`TAIJUTSU #1215=Targeted|Powerful|Disrupt|Flurry|DoT|Feint|Counter|Clash|Block|Evade|Avoid|Collab

	&LIST`SPECS`BUKIJUTSU #1215=Targeted|Powerful|Disrupt|Flurry|DoT|Feint|Counter|Clash|Turtle|Block|Collab

	&LIST`SPECS`CHAKRA-FLOW-TAIJUTSU #1215=Targeted|Powerful|Disrupt|Flurry|Charge|Feint|DoT|Absorb|Drain|Counter|Clash|Turtle|Block|Evade|Avoid|Collab

	&LIST`SPECS`CHAKRA-FLOW-BUKIJUTSU #1215=Targeted|Powerful|Disrupt|Flurry|Charge|Feint|DoT|Drain|Counter|Clash|Turtle|Reflection|Block|Collab

	&LIST`SPECS`NINJUTSU #1215=Targeted|Powerful|Disrupt|Barrage|Charge|Feint|DoT|Absorb|Drain|Clash|Turtle|Barrier|Reflection|Block|Evade|Avoid|Collab

	&LIST`SPECS`NINTAIJUTSU #1215=Targeted|Powerful|Disrupt|Barrage|Charge|Feint|DoT|Absorb|Drain|Counter|Clash|Turtle|Barrier|Reflection|Block|Evade|Avoid|Collab

	&LIST`SPECS`SEALS #1215=Targeted|Powerful|Disrupt|Flurry|Barrage|Charge|DoT|Absorb|Drain|Clash|Turtle|Barrier|Reflection|Block|Evade|Avoid|Collab

	&LIST`SPECS`CALLIGRAPHY #1215=Targeted|Powerful|Disrupt|Flurry|Barrage|Charge|Feint|DoT|Absorb|Drain|Counter|Clash|Turtle|Barrier|Reflection|Block|Evade|Avoid|Collab

	&LIST`SPECS`COMBINATION #1215=Absorb|Avoid|Barrage|Barrier|Block|Charge|Clash|Collab|Counter|Disrupt|DoT|Drain|Evade|Feint|Flurry|Powerful|Reflection|Targeted|Turtle

	&LIST`SPECS`TOTA #1215=Absorb|Avoid|Barrage|Barrier|Block|Charge|Clash|Collab|Counter|Disrupt|DoT|Drain|Evade|Feint|Flurry|Powerful|Reflection|Targeted|Turtle

@@ Jutsu Resource Costs:

	@@ XP: Base Cost * (1 + (special actions * .2))

	&FN`JUTSUXPCOST #1215=[round(mul([elementsmux([get(#254/dat`JutsuRanks`costs)], [match([get(#254/Dat`JutsuRanks)], [elementsmux([get(%0/dat`jutsuapp)], 8, |)],|)],|)], [add(1,mul([words([elementsmux(get(%0/dat`jutsuapp),7,|)],~)],.2))]),-1)]

<<<<<<< HEAD
	@@ XP Discounted: Base * (Affinity Discount (.75) - ET Discount (.05/.15/.25))

	&FN`JUTSUXPCOST_DISCOUNTED #1215=[floor(mul([u(fn`jutsuXPCost, %0)], [sub(switch(1,[and([match(get(%0/Dat`AffinityList),[extract(get(%0/dat`jutsuapp),5,1,|)],|)],[match(Ninjutsu|Nintaijutsu,[extract(get(%0/dat`jutsuapp),4,1,|)],|)])],.75,[and([match(get(%0/Dat`AffinityList),Yang,|)],[match(Taijutsu|Bukijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu,[extract(get(%0/dat`jutsuapp),4,1,|)],|)])],.75,[and([match(get(%0/Dat`AffinityList),Yin,|)],[match(Seals|Calligraphy,[extract(get(%0/dat`jutsuapp),4,1,|)],|)])],.75,1), [switch([after(grab([get(%0/dat`ExpertiseList)], Elite Tradition*, |), ^)], 0, .05, 1, .15, 2, .25, 0)])]))]

	&FN`JUTSUKPCOST #1215=[elementsmux([v(list`KP-jutsu)], [match([u(#244/dat`ranks)], [elementsmux([get(%0/dat`jutsuapp)], 8, |)], |)], |)]
	
	&FN`JUTSUKPCOST_DISCOUNTED #1215=[max(1, [sub([elementsmux([v(list`KP-jutsu)], [match([u(#244/dat`ranks)], [elementsmux([get(%0/dat`jutsuapp)], 8, |)], |)], |)], [after(elementsmux(get(%0/Dat`ExpertiseList),[match(get(%0/Dat`ExpertiseList),Elite Tradition*,|)],|),^)])])]

		&LIST`KP-JUTSU #1215=2|3|4|6|7|8

	&FN`JUTSUAPCOST #1215=[if([match(Attack, [elementsmux([get(%0/dat`jutsuapp)],6,|)])], [elementsmux(get(#254/Dat`[elementsmux(get(%0/dat`jutsuapp),3,|)]`AP),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 8, |)],|)],|)],0)]
	
	&FN`JUTSUSTAMINACOST #1215=[ceil(mul(elementsmux(get(#254/Dat`[edit([elementsmux(get(%0/dat`jutsuapp),4,|)], %b, -)]`Stamina),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 8, |)],|)],|),add(1,mul([words([extract(get(%0/dat`jutsuapp),7,1,|)],~)],.1))))]
	
	&FN`JUTSUCHAKRACOST #1215=[ceil(mul(elementsmux(get(#254/Dat`[edit([elementsmux(get(%0/dat`jutsuapp),4,|)], %b, -)]`Chakra),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 8, |)],|)],|),add(1,mul([words([extract(get(%0/dat`jutsuapp),7,1,|)],~)],.1))))]	
=======
	&FN`JUTSUKPCOST #1215=[elements([v(list`KP-jutsu)], [match([u(#244/dat`ranks)], [elementsmux([get(%0/dat`jutsuapp)], 9, |)], |)], |)]

	&FN`JUTSUKPCOST_DISCOUNTED #1215=[max(1, [sub([elements([v(list`KP-jutsu)], [match([u(#244/dat`ranks)], [elementsmux([get(%0/dat`jutsuapp)], 9, |)], |)], |)], [after(elements(get(%0/Dat`ExpertiseList),[match(get(%0/Dat`ExpertiseList),Elite Tradition*,|)],|),^)])])]

		&LIST`KP-JUTSU #1215=2|3|4|6|7|8

	&FN`JUTSUAPCOST #1215=[if([match(Attack|Heal,[elementsmux([get(%0/dat`jutsuapp)],6,|)],|)], [elementsmux(get(#254/Dat`[elementsmux(get(%0/dat`jutsuapp),3,|)]`AP),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 9, |)],|)],|)],0)]

	&FN`JUTSUSTAMINACOST #1215=[ceil(mul(extract(get(#254/Dat`[edit(extract(get(%0/dat`jutsuapp),4,1,|),%b,-)]`Stamina),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 9, |)],|)],1,|),add(1,mul([words([extract(get(%0/dat`jutsuapp),7,1,|)],~)],.1))))]

	&FN`JUTSUCHAKRACOST #1215=[ceil(mul(extract(get(#254/Dat`[edit(extract(get(%0/dat`jutsuapp),4,1,|),%b,-)]`Chakra),[match(get(#254/dat`JutsuRanks),[elementsmux([get(%0/dat`jutsuapp)], 9, |)],|)],1,|), add(1,mul([words([extract(get(%0/dat`jutsuapp),7,1,|)],~)],.1))))]

>>>>>>> 4e7b069a3d8eb6b483d752999dba576975a06667

-------------------------[ Jutsu Apps - Staff Side ]-------------------------

&CMD`STAFFJUTSUAPPS #1215=$+JutsuApps:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[error()]}; @pemit %#=[printf($^78:[ansi(hb, -=)]:s, < [ansi(hw, Jutsu Apps)] >)]%r[iter(get(#1215/List`JutsuApps), #@. [name(##)] %(##%),,%r)]%r[printf($^78:[ansi(hb, -=)]:s, < [ansi(hw, End Jutsu Apps)] >)]

&CMD`STAFFJUTSUAPPVIEW #1215=$+JutsuApps/view *:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[error()]}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(Game)] Invalid player.}; @assert [match([get(#1215/list`JutsuApps)], %q0)]={@pemit %#=[prompt(Game)] That person doesn't have a jutsu app in the queue.}; @pemit %#=[u(#1215/func`JutsuApp-View, %q0)]

&CMD`STAFFJUTSUALTER #1215=$+JutsuApps/alter *=*/*:@assert hasslabs(%#,staff-skill)={@pemit %#=[Prompt(System)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(Game)] Invalid player.}; @assert [match([get(#1215/list`jutsuapps)], %q0)]={@pemit %#=[prompt(App)] [name(%0)] does not have a Jutsu App in the queue.};  @assert [setr(1, [if([and([isnum(%1)], [lte(1, %1, 11)])], %1, [match([v(list`Jutsu-AppFields)], %1*, |)])])]={@pemit %#=[prompt(app)] That is not a valid Jutsu App Field.}; @assert [t([setr(2, [trim([securex(%2, a %(%)%%%,;)])])])]={@pemit %#={[prompt(app)] The [elementsmux([v(list`jutsu-appfields)], %q0, |)] field has been reset.}; @set %#=dat`jutsuapp:[replace([get(%#/dat`jutsuapp)], %q0,,|)]}; @include #1215/fn`[elements([v(list`jutsu-appFuncs)], %q1, |)]=%q0, %q2, %#; @pemit %#=[u(func`JutsuApp-View, %q0)]

&CMD`STAFFJUTSUAPPROVE #1215=$+JutsuApps/Approve *:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[prompt(App)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(Game)] Invalid player.}; @assert [match(get(#1215/List`JutsuApps), %q0)]={@pemit %#=[prompt(Game)] That person doesn't have an app in the queue.}; @assert [gte([get(%q0/dat`XP)], [setr(2, [if([hasattr(%q0/dat`NPC)], 0, [u(fn`JutsuXPCost_discount, %q0)])])])]={@pemit %#=[prompt(app)] [ansi(hy, [cname(%q0)])] (%q0) does not have enough XP to make this jutsu.; @pemit %q0=[prompt(App)] You do not have enough XP for your jutsu application at this time.}; @assert [hasattr(%q0/dat`jutsuapproval)]={@set %q0=dat`jutsuapproval:%#; @cemit monitor-app={[prompt(App)] [ansi(hc, %K)] has approved [ansi(hy,[name(*%0)])]'s Jutsu. They need one more staff member to approve them.}}; @assert [!strmatch(%#, [get(%q0/dat`jutsuapproval)])]={@pemit %#=[prompt(App)] You can't approve them again. Ask some other staff member to do this.}; @eval [setq(1, [u(fn`jutsukpcost, %q0)])][if([t([setr(3, [sqlite_query(Game, select ID from Templates where [iter([get(#1215/list`jutsu-sql)], ##="[elementsmux([get(%q0/dat`jutsuapp)], [elementsmux([get(#1215/list`jutsu-sqlcols)], #@)], |)]",, %band%b)])])])],, [setq(4, {insert into Templates [chr(40)][iter(ID [get(#1215/list`jutsu-sql)] KP XP Stamina Chakra AP, ##,,[chr(44)])][chr(41)] values[chr(40)][u(#1215/dat`next_id)][chr(44)] [iter([get(#1215/list`jutsu-sqlcols)], "[elementsmux([get(%q0/dat`jutsuapp)], ##, |)]",,[chr(44)])][chr(44)] %q1[chr(44)] [u(fn`JutsuXPCost, %q0)][chr(44)] [u(#1215/fn`jutsustaminacost, %q0)][chr(44)] [u(#1215/fn`jutsuchakracost, %q0)][chr(44)] [u(#1215/fn`jutsuapcost, %q0)][chr(41)]})][sqlite_query(Game, %q4)])]; @set %q0=dat`JutsuAttributes`[edit([elementsmux([get(%q0/dat`jutsuapp)], 1, |)], %b, -)]:1|1|1|1|1|1|[if([t(%q3)], %q3, [v(dat`next_id)])]|[iter(1 10 5 11 12, [elementsmux([get(%q0/dat`jutsuapp)], ##, |)],,|)]|[name(%q0)]|1|0; @cemit monitor-app={The jutsu "[elements(get(%q0/dat`jutsuapp),1,|)]" has been approved for [ansi(hm, [cname(%q0)])] by %K and [cname([get(%q0/dat`jutsuapproval)])]. There are [sub(words(get(#1215/List`JutsuApps)),1)] remaining in queue.}; @skip/ifelse [!t(%q3)]={@set #1215=dat`next_ID:[inc([get(#1215/dat`next_ID)])]}; @pemit %q0=[prompt(App)] Your application for the "[elements(get(%q0/dat`jutsuapp),1,|)]" jutsu has been approved. %q2 XP has been deducted.; @set %q0=dat`XP:[sub([get(%q0/dat`XP)], %q2)]; @set #1215=List`JutsuApps:[remove([get(#1215/List`JutsuApps)],%q0)]; @skip/ifelse [!eq([get(%q0/dat`KP-jutsu)], [setr(1, [if([hasattr(%q0/dat`NPC)], 0, [u(fn`jutsukpcost, %q0)])])])]={@set %q0=dat`KP:[min([switch(1, [t([match([get(%q0/dat`flaws)], Inept)])], 10, [t([match([get(%q0/dat`Merits)], Gifted)])], 15, 12)], [add([get(%q0/dat`KP)], [get(%q0/dat`KP-jutsu)], [mul(-1, %q1)])])]}; @wipe %q0/dat`jutsuapproval; @wipe %q0/dat`jutsuapp; @wipe %q0/dat`KP-jutsu

&CMD`JUTSUAPPDENIAL #1215=$+JutsuApps/Deny *=*:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[Prompt(Game)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(App)] That is not a valid player.}; @assert [match(get(#1215/List`JutsuApps), %q0)]={@pemit %#=[prompt(Staff)] There is no Jutsu App for [name(%q0)].};@wipe %q0/dat`jutsuapproval; @set #1215=List`JutsuApps:[remove([get(#1215/List`JutsuApps)],%q0)]; @cemit Monitor-App={%k has just denied [name(%q0)]'s Jutsu App for the following reason: %1}; @force [pmatch(NML-Bot)]={mail %q0=Jutsu App Denied//{Your current Jutsu Application for [extract(get(%q0/dat`jutsuapp),1,1,|)] has been denied for the following reason(s):%%r%%r%1%%r%%rIf you have any questions, please send in a [ansi(hg, +request)].}}

---------------------------------[ TF Apps ]---------------------------------

&CMD`TFCREATE #1215=$+app/tf create:@pemit %#=[prompt(Game)] Your TF App has been reset.; @wipe %#/dat`tfapp

&CMD`TFAPP-VIEW #1215=$+app/tf:@pemit %#=[u(#1215/func`tf-View, %#)]

	&FUNC`TF-VIEW #1215=[printf($78^:[ansi(hb, -=)]:s, %[ [ansi(hw, [name(%0)]'s Transformation App)] %])]%r[printf($9s $27s | $11s $26s, 1. [ansi(hc, Name)]:, [elementsmux([setr(0, [get(%0/dat`TFapp)])], 1, |)], 2. [ansi(hc, Access)]:, [elementsmux(%q0, 2, |)])]%r[center(%[ Jutsu Mastery Fields %], 78, -)]%r[iter([lnum(3,8)] , [printf($2s. $33^&s, ##, [ansi([if([elementsmux(%q0, ##, |)], hg, hr)], [elementsmux([v(list`tf-appfields)], ##, |)])])][if([!mod(##, 2)], %r, %b|%b)],,)][center(%[ Performance Fields %], 78, -)]%r[iter([lnum(9, 14)], [printf($2s. $33^&s, ##, [ansi([if([elementsmux(%q0, ##, |)], hg, hr)], [elementsmux([v(list`tf-appfields)], ##, |)])])][if([!mod(##, 2)], %r, %b|%b)],,)]%r[center([ansi(hc, Remaining Bonuses)]: [sub(5, [ladd([extract(%q0, 3, 12, |)], |)])]/5, 78)]%r%r[center(%[ 15. Description %], 78, -)]%r[elementsmux(%q0, 15, |)]%r[printf($78^:[ansi(hb, -=)]:s, %[ End TF App %])]

&CMD`TFAPP #1215=$+app/tf *=*:@assert [or([and([isnum(%0)], [lte(1, %0, 15)])], [t([setr(8, [elements([v(list`TF-AppNums)], [match([v(list`TF-AppDescs)], %0*, |)], |)])])])]={@pemit %#=[prompt(app)] [ansi(hy, %0)] is not a valid TF App Field.}; @assert [t(%1)]={@pemit %#={[prompt(app)] The [elements([v(list`TF-AppFields)], [if([isnum(%0)], %0, %q8)], |)] field has been reset.}; @set %#=dat`TFapp:[replace([get(%#/dat`TFapp)], [if([isnum(%0)], %0, %q8)],,|)]}; @include #1215/fn`TFApp`[elements([v(list`tf-appFuncs)], [if([isnum(%0)], %0, %q8)], |)]=[trim([securex(%1, %%%,;)])], [if([isnum(%0)], %0, %q8)]

	&FN`TFAPP`NAME #1215=@assert [lte([strlen(%0)], 22)]={@pemit %#=[prompt(Game)] Your TF's Name must be less than 22 characters.}; @break [match([sqlite_query(Game, select Name from Transformations)], %0, ^)]={@pemit %#=[prompt(game)] There is a TF with that name already existing.}; @set %#=dat`TFApp:[replace([get(%#/dat`TFApp)], 1, %0, |)]; @pemit %#=[prompt(Game)] Your TF now has the name of [ansi(y, [elementsmux([get(%#/dat`TFapp)], 1, |)])].

	&FN`TFAPP`ACCESS #1215=@assert [match(Clan None [get(%#/dat`clan)], %0)]={@pemit %#=[prompt(Game)] You cannot create a TF for a clan you are not a part of. If you have no clan, type 'None'.}; @set %#=dat`TFApp:[replace([get(%#/dat`TFApp)], 2, [switch(%0, None, None, [get(%#/dat`Clan)])], |)]; @pemit %#=[prompt(Game)] Your TF now has the Access of [ansi(y, [elementsmux([get(%#/dat`TFapp)], 2, |)])].

	&FN`TFAPP`DESC #1215=@assert [lte(100, [strlen(%0)], 1000)]={@pemit %#=[prompt(Game)] Your TF description must be between 100 and 1000 characters long.}; @set %#=dat`TFApp:[replace([get(%#/dat`TFApp)], 15, %0, |)]; @pemit %#=[prompt(Game)] Your TF now has the Description of [ansi(y, [elementsmux([get(%#/dat`TFapp)], 15, |)])]

	&FN`TFAPP`BONUS #1215=@assert [match(Yes No, %0)]={@pemit %#=[prompt(Game)] These fields require 'Yes' or 'No' responses.}; @skip/ifelse [strmatch(%0, Yes)]={@assert [lte(0, [ladd([extract([get(%#/dat`TFApp)], 3, 12, |)], |)], 4)]={@pemit %#=[prompt(Game)] You can only set 5 fields to 'Yes'.}; @set %#=dat`TFApp:[replace([get(%#/dat`TFApp)], %1, 1, |)]; @pemit %#=[prompt(Game)] You have set the [elements([v(list`tf-appfields)], %1, |)] Field to 'Yes'.}, {@set %#=dat`TFApp:[replace([get(%#/dat`TFApp)], %1, 0, |)]; @pemit %#=[prompt(Game)] You have set the [elements([v(list`tf-appfields)], %1, |)] Field to 'No'.}

	&list`tf-appFuncs #1215=Name|Access|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Bonus|Desc

	&list`TF-AppDescs #1215=Name|Access|Precision|Potency|Form|Efficiency|Effectiveness|Adaptability|Mitigation|Penetration|Critical Chance|Crit Chance|Damage Reduction|DR|Mental Bonus|Perception Bonus|Description

	&list`TF-AppNums #1215=1|2|3|4|5|6|7|8|9|10|11|11|12|12|13|14|15

	&list`TF-AppFields #1215=Name|Access|Precision|Potency|Form|Efficiency|Effectiveness|Adaptability|Mitigation|Penetration|Critical Chance|Damage Reduction|Mental Bonus|Perception Bonus|Description

	&list`TF-SQLFields #1215=Precision|Potency|Form|Efficiency|Effectiveness|Adaptability|Special|Mit|Pen|Crit|DR|Mental|Perception|Access|Name|Desc

&CMD`TFAPPSUBMIT #1215=$+App/TF Submit:@assert [!match([v(list`TFApps)], %#)]={@pemit %#=[prompt(App)] You already have a TF App in the queue.}; @break [t([sqlite_query(Game, Select Name from Transformations where Name LIKE "[setr(0, [elements([get(%#/dat`TFApp)], 1, |)])]")])]={@pemit %#=[prompt(App)] The %q0 Transformation already exists.}; @assert gte(get(%#/Dat`XP),[if(hasattr(%#/dat`NPC), 0, 10000)])={@pemit %#=[prompt(App)] You need 10,000 XP to purchase a Transformation.} ;@assert gte(get(%#/Dat`KP),[if(hasattr(%#/dat`NPC), 0, 8)])={@pemit %#=[prompt(App)] You need 8 KP to purchase a Transformation.} ; @assert [eq(5, [ladd([extract([get(%#/dat`TFApp)], 3, 12, |)], |)])]={@pemit %#=[prompt(App)] You must have exactly 5 TF Slots used.}; @assert [and([t(%q0)], [t([elementsmux([get(%#/dat`TFApp)], 2, |)])], [t([elementsmux([get(%#/dat`TFApp)], 15, |)])])]={@pemit %#=[prompt(Game)] You do not have the Name, Clan, and/or Description Fields filled out.}; @pemit %#={[prompt(App)] Your application for the "%q0" Transformation has been submitted. Please wait up to 72 hours for a response.}; @cemit Monitor-app=[ansi(y, %N)] has submitted a TF for approval.; @eval [setq(1, [if(hasattr(%#/dat`NPC), 0, 8)])][if([!hasattr(%#/dat`KP-TF)], [set(%#, dat`KP:[sub([get(%#/dat`KP)], %q1)])][set(%#, dat`KP-TF:%q1)])][set(#1215, list`TFApps:[get(#1215/list`TFApps)] %#)]

---------------------------[ TF Apps - Staff Side ]--------------------------

&CMD`STAFFTFAPPS #1215=$+TFApps:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[error()]}; @pemit %#=[printf($^78:[ansi(hb, -=)]:s, < [ansi(hw, TF Apps)] >)]%r[iter(get(#1215/List`TFApps), #@. [name(##)] %(##%),,%r)]%r[printf($^78:[ansi(hb, -=)]:s, < [ansi(hw, End TF Apps)] >)]

&cmd`staffTFView #1215=$+TFApps/view *:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[error()]}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(Game)] Invalid player.}; @assert [match([get(#1215/list`TFApps)], %q0)]={@pemit %#=[prompt(Game)] That person doesn't have a jutsu app in the queue.}; @pemit %#=[u(#1215/func`TF-View, %q0)]

&CMD`STAFFTFALTER #1215=$+TFApps/alter *=*/*:@assert hasslabs(%#,staff-skill)={@pemit %#=[Prompt(Game)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(Game)] Invalid player.}; @assert [match([get(#1215/list`TFApps)], %q0)]={@pemit %#=[prompt(App)] [name(%q0)] does not have a Jutsu App in the queue.}; @assert [or([and([isnum(%1)], [lte(1, %1, 15)])], [t([setr(8, [elements([v(list`TF-AppNums)], [match([v(list`TF-AppDescs)], %1*, |)], |)])])])]={@pemit %#=[prompt(app)] [ansi(hy, %1)] is not a valid TF App Field.}; @assert [t(%1)]={@pemit %#={[prompt(app)] The [elements([v(list`TF-AppFields)], [if([isnum(%1)], %1, %q8)], |)] field has been reset.}; @set %q0=dat`TFapp:[replace([get(%q0/dat`TFapp)], [if([isnum(%1)], %1, %q8)],,|)]}; @pemit %#=[printf($^78:[ansi(hb, -=)]:s, < [ansi(hw, [name(%q0)] %(%q0%)'s TF App Change)] >)]%r[center(Old [setr(1, [elements([v(list`TF-AppFields)], [if([isnum(%1)], %1, %q8)], |)])] Field Value: [elementsmux([get(%q0/dat`TFApp)], %1, |)], 78)]%r%r[center(New %q1 Field Value: [securex({%2}, %%%,;)], 78)]%r%r; @set %q0=dat`TFapp:[replace([get(%q0/dat`TFapp)], [if([isnum(%1)], %1, %q8)],[securex({%2}, %,%%;)],|)]; @pemit %#=[u(func`TF-view, %q0)]

&CMD`STAFFTFAPPROVE #1215=$+TFApps/approve *:@assert hasslabs(%#,staff-skill)={@pemit %#=[Prompt(System)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch([secure(%0)])])])]={@pemit %#=[prompt(game)] [secure(%0)] is not a player.}; @assert [match(get(#1215/List`TFApps),%q0)]={@pemit %#=[prompt(Game)] [name(%q0)] does not have a TF app in the queue.}; @assert [gte([get(%q0/dat`XP)], [setr(3, [if(hasattr(%q0/dat`NPC), 0, 10000)])])]={@pemit %#=[prompt(App)] [ansi(y, [name(%q0)] doesn't have enough XP for a new TF.}; @assert [!t([sqlite_query(Game, select Name from Transformations where Name LIKE "[setr(1, [elementsmux([get(%q0/dat`TFApp)], 1, |)])]")])]={@pemit %#=[prompt(Staff)] The "%q1" Transformation already exists in the Database.}; @assert [hasattr(%q0/dat`TFapproval)]={@set %q0=dat`TFapproval:%#; @cemit monitor-app={[prompt(App)] [ansi(hc, %K)] has approved [ansi(hy,[name(%q0)])]'s Transformation. They need one more staff member to approve them.}}; @assert [!strmatch(%#, [get(%q0/dat`TFapproval)])]={@pemit %#=[prompt(App)] You can't approve them again. Ask some other staff member to do this.}; @eval [setq(4, Insert into Transformations [chr(40)][iter([get(#1215/list`TF-SQLCols)], ##,|,[chr(44)])][chr(41)] values [chr(40)][iter([get(#1215/list`TF-SQL)], "[if([lte(1, #@, 12)], [if([elementsmux([get(%q0/dat`TFApp)], ##, |)], Yes, No)], [elementsmux([get(%q0/dat`TFApp)], ##, |)])]",,[chr(44)])][chr(41)])][sqlite_query(Game, %q4)]; @cemit Monitor-App=[prompt(App)] The Transformation "%q1" has been approved by %K and [cname([get(%q0/dat`TFapproval)])] for [ansi(y, [name(%q0)])]. There are [sub(words(get(#1215/List`TFApps),|),1)] remaining in queue.; @pemit %q0=[prompt(Game)] Your application for the "%q1" Transformation has been approved.;@set %q0=Dat`XP: [sub(get(%q0/Dat`XP), %q3)]; @wipe %q0/dat`TFApp; @set #1215=List`TFApps:[remove([get(#1215/List`TFApps)], %q0)]; @set %q0=dat`TFList:[setunion([get(%q0/dat`TFList)], %q1, |)]; @wipe %q0/dat`TFApproval; @wipe %q0/dat`KP-TF

	&list`tf-sql #1215=3 4 5 6 7 8 9 10 11 12 13 14 1 2 15
	&list`tf-sqlcols #1215=Precision|Potency|Form|Efficiency|Effectiveness|Adaptability|Mit|Pen|Crit|DR|Mental|Perception|Name|Access|Desc

&CMD`TFAPPDENIAL #1215=$+TFApps/deny *=*:@assert [hasslabs(%#,staff-skill)]={@pemit %#=[Prompt(Game)] You are not permitted to use this command.}; @assert [t([setr(0, [pmatch(%0)])])]={@pemit %#=[prompt(App)] That is not a valid player.}; @assert [match(get(#1215/List`TFApps), %q0)]={@pemit %#=[prompt(Staff)] There is no TF App for [name(%q0)].}; @wipe %q0/dat`TFapproval; @set #1215=List`TFApps:[remove([get(#1215/List`TFApps)],%q0)]; @cemit Monitor-App={%k has just denied [name(%q0)]'s TF App for the following reason: %1}; @force [pmatch(NML-Bot)]={mail %q0=TF App Denied//{Your current TF Application for [elementsmux(get(%q0/dat`TFApp),1,|)] has been denied for the following reason(s):%%r%%r%1%%r%%rIf you have any questions, please send in a [ansi(hg, +request)].}}

--------------------------------[ Clan TFs ]---------------------------------

&CMD`CLANTF #1215=$+ClanTF:@assert [match([v(list`ClanTF-clans)], [get(%#/dat`Clan)], |)]={@pemit %#=[prompt(Game)] Your clan does not have a Transformation.}; @assert [!match([get(%#/dat`TFList)], [setr(0, [elements([get(#1215/list`ClanTF-TFs)], [match([get(#1215/list`ClanTF-clans)], [get(%#/dat`clan)], |)], |)])], |)]={@pemit %#=[prompt(Game)] You have already unlocked your Kekkei Genkai Transformation.}; @assert [gte([get(%#/dat`XP)], [setr(2, [if([hasattr(%#/dat`NPC)], 0, 10000)])])]={@pemit %#=[prompt(Game)] You do not have enough XP (%q0) to purchase your the "%q0" Transformation.}; @assert [gte([get(%#/dat`KP)], [setr(1, [if([hasattr(%#/dat`NPC)], 0, [sub(8, [after([grab(%#/dat`ExpertiseList, Elite Tradition*, |)],^)])])])])]={@pemit %#=[prompt(Game)] You do not have enough KP (%q1) to purchase a TF.}; @set %#=dat`TFList:[setunion([get(%#/dat`TFList)], %q0, |)]; @set %#=dat`XP:[sub([get(%#/dat`XP)], %q2)]; @set %#=dat`KP:[sub([get(%#/dat`KP)], %q1)]; @pemit %#={[prompt(Game)] You have purchased your clan's Transformation (%q0) for %q2 XP and %q1 KP. You have [get(%#/dat`XP)] XP and [get(%#/dat`KP)] KP left.}; @remit %L=[prompt(Game)] %N awakens the potential of their Clan!; @cemit Monitor-App=[if([hasattr(%#/dat`NPC)], [ansi(hm, [chr(40)][get(%#/dat`NPC)][chr(41)])%b])][ansi(hy, %N)] (%#) purchased their Clan TF (%q0) for %q2 XP and %q1 KP.

&LIST`CLANTF-CLANS #1215=Uchiha|Hyuuga|Kaguya|On'You|Akimichi|Inuzuka|Hozuki

&LIST`CLANTF-TFS #1215=Sharingan|Byakugan|Shikotsumyaku|Kokuuzou|Super Multi-Size|Four Legs|Hydrification

-----------------------------[ Auto Purchases ]------------------------------

&CMD`STATBUY #1215=$+buy/stat *:@assert [hasattr(%#/dat`Approval)]={@pemit %#=[prompt(Game)] Please complete CG before buying stats.}; @break [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(App)] You cannot purchase things while in Order.%r};@assert [setr(0, [match(get(#244/Dat`PrimaryStats),%0,|)])]={@pemit %#=[Prompt(App)] [caplist(%0)] is not a Primary Stat.};@assert [lt([elements([get(%#/dat`PrimaryStats)], %q0, |)], [add(9, -[t([match([get(%#/dat`Flaws)], Inferior %0, |)])], [or([match([get(%#/dat`Merits)], Greater %0, |)], [match([get(%#/dat`Merits)], Genius, |)])])])]={@pemit %#=[Prompt(App)] [capstr([lcstr(%0)])] cannot be raised further.}; @assert [or(gte([get(%#/dat`KP)], [max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)]), [hasattr(%#/Dat`NPC)])]={@pemit %#=[prompt(app)] You require at least 3 Knowledge Points to raise a stat.}; @assert gte(get(%#/Dat`XP), [setr(1, [if([hasattr(%#/Dat`NPC)],0,switch(get(%#/Dat`Tier),0,250,1,500,2,750,3,1000,4,1500,5,2000,6,2500,7,3500,8,5000))])])={@pemit %#=[Prompt(App)] You need %q1 XP to raise a stat.}; @set %#=Dat`PrimaryStats:[replace([get(%#/dat`PrimaryStats)], %q0, [inc([elements([get(%#/dat`PrimaryStats)], %q0, |)])], |)]; @set %#=Dat`KP:[sub([get(%#/dat`KP)], [if([hasattr(%#/Dat`NPC)],0,max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1))])]; @set %#=Dat`XP:[sub([get(%#/dat`XP)], %q1)]; @pemit %#={[prompt(app)] [elements([get(#244/dat`PrimaryStats)], %q0, |)] has been raised to [elements([get(%#/dat`PrimaryStats)], %q0, |)] for %q1 XP and [max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)] KP[if([match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],%b%(Elite Tradition%),)]. You have [get(%#/dat`XP)] XP and [get(%#/dat`KP)] KP remaining.}; @skip/ifelse [match(17 25 33 41 49 57 65 73, [ladd([get(%#/dat`PrimaryStats)], |)])]={@set %#=dat`Tier:[inc([get(%#/dat`Tier)])]; @pemit %#={[prompt(Game)] Your tier has increased to Tier [get(%#/dat`Tier)].}; {@eval [switch(1, [lte(1, [get(%#/dat`Tier)], 2)], [setq(2, 3)][setq(3, 3)], [lte(3, [get(%#/dat`Tier)], 4)], [setq(2, 2)][setq(3, 2)], [lte(5, [get(%#/dat`tier)], 6)], [setq(2, 1)][setq(3, 1)], [gte(7, [get(%#/dat`tier)])], [setq(2, 0)][setq(3, 0)])]}; @wait 0={@set %#=dat`SpecialtySlots:[add([get(%#/dat`SpecialtySlots)], %q2)]; @set %#=Dat`ExpertiseSlots:[add([get(%#/dat`ExpertiseSlots)], %q3)]; @pemit %#=[prompt(Game)] You have gained %q2 Specialty Slots and %q3 Expertise Slots.}}; @eval [u(#245/func`Refresh)]; @cemit Monitor-App= [ansi(hm, %N)] %(%#%) has increased their [capstr([lcstr(%0)])] Stat.

&CMD`PROFICIENCYAPP #1215=$+buy/proficiency *:@break [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Game)] You cannot purchase things while in Order.%r};@break hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@break [or(gte(get(%#/Dat`KP),[max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)]),[hasattr(%#/Dat`NPC)])]={@break [or(gte(get(%#/Dat`XP),[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,1000,2,2000,3,3000,4,4000,5,5000)]),[hasattr(%#/Dat`NPC)])]={@break lt([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],6)={ @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1)],|)] ;@set %#=Dat`XP:[sub(get(%#/Dat`XP),[if([hasattr(%#/Dat`NPC)],0,[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,2000,4,3000,5,4000,6,5000)])])]; @set %#=Dat`KP:[sub(get(%#/Dat`KP),[if([hasattr(%#/Dat`NPC)],0,[max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])])]; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],2,4,3,4,4,5,5,5,6,6)])],|)];@pemit %#=[prompt(Game)] %N has increased the Jutsu Proficiency Level of [caplist(%0)] to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)], raising the amount of available Jutsu Mastery Points to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)] for [switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,2000,4,3000,5,4000,6,5000)] XP and [max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)] KP[if([match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],%b%(Elite Tradition%),)]. %r%r [get(%#/Dat`XP)] XP, and [get(%#/Dat`KP)] KP remain. ;@cemit monitor-app=[prompt(App)] %N has increased the Proficiency Level of their [caplist(%0,,,L)] jutsu to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)]. };@pemit %#=[prompt(Game)] %N has already achieved the maximum Proficiency Level for the [caplist(%0)] jutsu. };@pemit %#=[prompt(Game)] %N does not have enough XP. };@pemit %#=[prompt(Game)] %N does not have enough KP.}; @pemit %#=[prompt(Game)] %N does not have the [caplist(%0)] Jutsu.

&CMD`MASTERYAPP #1215=$+buy/mastery *=*:@assert [hasattr(%#/dat`approval)]={@pemit %#=[prompt(game)] You cannot buy things while in CG.}; @assert [hasattr(%#/dat`JutsuAttributes`[edit(%0, %b, -)])]={@pemit %#=[prompt(Game)] You do not have the "%0" Jutsu.}; @assert [match(get(#244/Dat`JutsuAttributes),%1,|)]={@pemit %#=[prompt(Game)] [caplist(%1)] is not a Jutsu Attribute.}; @assert lt([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)],10)={@pemit %#=[prompt(Game)] You have already mastered [caplist(%1)] for the [caplist(%0)] Jutsu.}; @assert gt([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],0)={@pemit %#=[prompt(Game)] The [caplist(%0)] jutsu has no Mastery Points to spend. Increase Proficiency with the Jutsu or attain Expertise in its Specialization to gain more points.}; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,[sub([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],1)],|)]; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)],1)],|)]; @pemit %#=[prompt(Game)] %N has increased the [caplist(%1)] Mastery Level of [caplist(%0)] to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)]!

&CMD`RPSKILL #1215=$+buy/RPskill *:@break [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(App)] You cannot purchase things while in Order.%r};@assert gt([extract(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),%0,|)],1,|)],0)={@pemit %#=[prompt(App)] You do not possess the [caplist(%0,,,L)] RP Skill.};@assert lt([extract(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),%0,|)],1,|)],10)={@pemit %#=[prompt(App)] Your [caplist(%0,,,L)] RP Skill is already at the maximum level of 10.};@assert match(get(#244/Dat`RPSkills),%0,|)={@pemit %#=[prompt(App)] [caplist(%0,,,L)] is not an RP Skill.};@assert [or([hasattr(%#/Dat`NPC)],gte(get(%#/Dat`XP),1000))]={@pemit %#=[prompt(App)] You do not have enough XP(1000) to upgrade the [caplist(%0,,,L)] RP Skill.};@assert [or([hasattr(%#/Dat`NPC)],gte(get(%#/Dat`KP),[max(sub(2,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)]))]={@pemit %#=[prompt(App)] You do not have enough KP([max(sub(2,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)]) to upgrade the [caplist(%0,,,L)] RP Skill.};@set %#=Dat`RPSkills:[replace(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),[grab(get(#244/Dat`RPSkills),%0,|)],|)],[add([extract(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),%0,|)],1,|)],1)],|)]; @set %#=Dat`XP:[sub(get(%#/Dat`XP),[if([hasattr(%#/Dat`NPC)],0,1000)])]; @set %#=Dat`KP:[sub(get(%#/Dat`KP),[if([hasattr(%#/Dat`NPC)],0,max(sub(2,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1))])]; @pemit %#=[prompt(App)] You have successfully increased your [caplist(%0,,,L)] RP Skill to [extract(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),%0,|)],1,|)]! You have [get(%#/Dat`XP)] XP and [get(%#/Dat`KP)] KP remaining.; @cemit monitor-app=[prompt(App)] %N has increased their [caplist(%0,,,L)] RP Skill to [extract(get(%#/Dat`RPSKills),[match(get(#244/Dat`RPSKILLs),%0,|)],1,|)].

&CMD`SPECSLOTEXPANSION #1215=$+buy/slot specialty:@break [match([get(%l/list`players)], %#)]={@pemit %#=[prompt(game)] You cannot purchase things while in Order.}; @assert [gt(8, [elements([get(%#/dat`SlotExpansion)], 1, |)])]={@pemit %#=[prompt(Game)] You have already purchased the maximum number of specialty slots.}; @assert [or([hasattr(%#/Dat`NPC)],gte([get(%#/dat`KP)], 10))]={@pemit %#=[prompt(Game)] You do not have enough KP to purchase an extra Specialty slot.}; @assert [or([hasattr(%#/Dat`NPC)],gte([get(%#/dat`XP)], 6500))]={@pemit %#=[prompt(game)] You do not have enough XP to purchase an extra Specialty Slot.}; @set %#=dat`kp:[sub([get(%#/dat`Kp)], [if([hasattr(%#/Dat`NPC)],0,10)])]; @set %#=dat`XP:[sub([get(%#/dat`XP)], [if([hasattr(%#/Dat`NPC)],0,6500)])]; @set %#=dat`SpecialtySlots:[inc([get(%#/dat`SpecialtySlots)])]; @set %#=dat`slotexpansion:[replace([get(%#/dat`slotexpansion)], 1, [inc([elements([get(%#/dat`slotexpansion)], 1, |)])], |)]; @pemit %#=[prompt(Game)] You have purchased a Specialty Slot Expansion upgrade for your character! You have received an extra Specialty Slot for 6500 XP and 10KP. You have [sub(8, [elements([get(%#/dat`SlotExpansion)], 1, |)])] slots remaining to purchase.; @cemit Monitor-App=[ansi(hm, %N)] has purchased an extra Specialty Slot for [ansi(hy, 6500)] XP and [ansi(hy, 10)] KP. %S has [sub(8, [elements([get(%#/dat`SlotExpansion)], 1, |)])] Slots remaining.

&CMD`EXPERTSLOTEXPANSION #1215=$+buy/slot expertise:@break [match([get(%l/list`players)], %#)]={@pemit %#=[prompt(game)] You cannot purchase things while in Order.}; @assert [gt(4, [elements([get(%#/dat`SlotExpansion)], 2, |)])]={@pemit %#=[prompt(Game)] You have already purchased the maximum number of expertise slots.}; @assert [or([hasattr(%#/Dat`NPC)],gte([get(%#/dat`KP)], 10))]={@pemit %#=[prompt(Game)] You do not have enough KP to purchase an extra Expertise slot.}; @assert [or([hasattr(%#/Dat`NPC)],gte([get(%#/dat`XP)], 6500))]={@pemit %#=[prompt(game)] You do not have enough XP to purchase an extra Expertise Slot.}; @set %#=dat`kp:[sub([get(%#/dat`Kp)], [if([hasattr(%#/Dat`NPC)],0,10)])]; @set %#=dat`XP:[sub([get(%#/dat`XP)], [if([hasattr(%#/Dat`NPC)],0,6500)])]; @set %#=dat`ExpertiseSlots:[inc([get(%#/dat`ExpertiseSlots)])]; @set %#=dat`slotexpansion:[replace([get(%#/dat`slotexpansion)], 2, [inc([elements([get(%#/dat`slotexpansion)], 2, |)])], |)]; @pemit %#=[prompt(Game)] You have purchased a Expertise Slot Expansion upgrade for your character! You have received an extra Expertise Slot for 6500 XP and 10KP. You have [sub(4, [elements([get(%#/dat`SlotExpansion)], 2, |)])] slots remaining to purchase.; @cemit Monitor-App=[ansi(hm, %N)] has purchased an extra Expertise Slot for [ansi(hy, 6500)] XP and [ansi(hy, 10)] KP. %S has [sub(4, [elements([get(%#/dat`SlotExpansion)], 2, |)])] Slots remaining.

&CMD`TFRANK #1215=$+TFRank *:@assert match(get(%#/Dat`TFList),%0,|)={@pemit %#=[prompt(Game)] You do not possess the [caplist(%0,,,l)] Transformation.};@assert lt(get(%#/Dat`TFRank`[setr(0, [edit(%0,%b,-)])]),3)={@pemit %#=[prompt(Game)] Your [caplist(%0,,,L)] Transformation is already at the maximum rank([get(%#/Dat`TFRank`%q0)]).};@assert [and([gte(get(%#/Dat`XP),[setr(2, [if([hasattr(%#/dat`NPC)], 0, 2500)])])],[gte(get(%#/Dat`KP),[setr(1, [if([hasattr(%#/dat`NPC)], 0, [max(sub(10,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])])])],[gte([sqlite_query(Game, select LP from Accounts where Email='[get(%#/dat`account)]')],[setr(3, [if([hasattr(%#/dat`NPC)], 0, 5)])])])]={@pemit %#=[prompt(Game)] You do not have enough XP, KP, or LP to purchase a TF Rank increase.}; @eval [set(%#,Dat`XP:[sub(get(%#/Dat`XP),%q2)])][set(%#,Dat`KP:[sub(get(%#/Dat`KP),%q1)])][sqlite_query(Game, update Accounts set LP=[sub([sqlite_query(Game, select LP from Accounts where Email='[get(%#/dat`account)]')],%q3)] where Email='[get(%#/dat`account)]')][set(%#,Dat`TFRank`%q0:[inc([get(%#/Dat`TFRank`%q0)])])]; @pemit %#=[prompt(Game)] You have increased your [caplist(%0,,,L)] Transformation to Rank [get(%#/Dat`TFRank`%q0)] for %q2 XP, %q1 KP, and %q3 LP!

--------------------------------[ Teaching ]---------------------------------

&CMD`JUTSULESSON #1215=$+Lesson/review:@pemit %#=[printf($:[ansi(hb,-=)]:^78s,[ansi(hb,\[)]%b[ansi(hw,+jutsu [extract(get(%#/Dat`JutsuShower),2,1,|)])]%b[ansi(hb,\])])]%r%r[printf($#3#&^78s,[ansi(hg,[extract([get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)])],12,1,|)])] [extract([get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)])],8,1,|)] \([extract([get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)])],11,1,|)]\))] %r[printf($#3#&^78s,[ansi(hc,Rank:)] [sqlite_query(Game, Select Rank From Templates Where ID="[extract([get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)])],7,1,|)]")] %t%t [ansi(hc,XP:)] [floor(mul(add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),[switch([extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)]),[switch(1,[and([match(get(%#/Dat`AffinityList),sqlite_query(Game, Select Type From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),|)],[match(Ninjutsu|Nintaijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),[if(match(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),%#),.1,0)],0)])],[and([match(get(%#/Dat`AffinityList),Yang,|)],[match(Taijutsu|Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),[if(match(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),%#),.1,0)],0)])],[and([match(get(%#/Dat`AffinityList),Yin,|)],[match(Seals|Calligraphy,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),[if(match(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),%#),.1,0)],0)])],[t(match(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Students),%#))],.9,1)]))])] %r%r [printf($#3#&^78s,[ansi(hc,Stamina:)] [ceil(sub(sqlite_query(Game, Select Stamina From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),mul(sqlite_query(Game, Select Stamina From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),[u(#1215/func`efficiencymod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])])))] %t [ansi(hc,Chakra:)] [ceil(sub(sqlite_query(Game, Select Chakra From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),mul(sqlite_query(Game, Select Chakra From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),[u(#1215/func`efficiencymod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])])))] %t [ansi(hc,AP:)] [if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],Defend),0,[max(add(sqlite_query(Game, Select AP From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),add([u(#1215/func`formmod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])],[if([extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Link),2,1,|)],1)])),[switch(1,[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],Taijutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),E,1,D,1,C,1,B,2,A,2,S,3)],[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],Ninjutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),E,2,D,2,C,3,B,3,A,4,S,4)])])])])] %r%r[printf($#3#&^78s,[ansi(hy,Proficiency Level:)] [switch([extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),14,1,|)],1,Novice,2,Practitioner,3,Adept,4,Skilled,5,Expert,6,Master)]\([extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),14,1,|)]\) %t [ansi(hy,Mastery Points:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),15,1,|)])] %r%r[printf($#3#&^78s,[ansi(hc,Precision:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),1,1,|)] \([u(#1215/Func`PrecisionMinRoll,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])]-[u(#1215/Func`PrecisionMaxRoll,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])]\) %t [ansi(hc,Potency:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),2,1,|)] \([u(#1215/Func`PotencyMinRoll,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])]-[u(#1215/Func`PotencyMaxRoll,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])]\) %r[ansi(hc,Form:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),3,1,|)] \([u(#1215/Func`FormMod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)])] AP\) %t%t [ansi(hc,Efficiency:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),4,1,|)] \([ceil(mul(u(#1215/Func`EfficiencyMod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)]),100))]\%\) %r[ansi(hc,Effectiveness:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),5,1,|)] \([ceil(mul(u(#1215/Func`EffectivenessMod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)]),100))]\%\) %t [ansi(hc,Adaptability:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),6,1,|)] \([mul(u(#1215/Func`AdaptabilityMod,[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)],[extract(get(%#/Dat`JutsuShower),1,1,|)]),100)]\%\))] %r%r[printf($#3#&^78s,[ansi(hr,Mitigation:)] [ceil(mul(add(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`Mit),IF(hasattr([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`TF),IF(Match([sqlite_query(Game, Select Mit From Transformations Where Name="[get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`TF)]")],Yes),[add(.2,mul([u(#1215/Func`EffectivenessMod,[extract(get(%#/Dat`JutsuShower),2,1,|)],[extract(get(%#/Dat`JutsuShower),1,1,|)])],.75))]),[add(0,mul([u(#1215/Func`EffectivenessMod,[extract(get(%#/Dat`JutsuShower),2,1,|)],[extract(get(%#/Dat`JutsuShower),1,1,|)])],.75))])),100))]\% %t [ansi(hr,Penetration:)] [ceil(mul(u(#1215/Func`PenMod),100))]\% %t [ansi(hr,Damage Reduction:)] [if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],Attack),0,[if(match([sqlite_query(Game, Select Special From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],Barrier,~),[ceil(mul(match(get(#254/Dat`JutsuRanks),[sqlite_query(Game, Select Rank From Templates where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[extract(get(%#/Dat`JutsuShower),2,1,|)]),7,1,|)]")],|),ceil(mul(750,[u(#1215/Func`DRMod)]))))],0)])])] %r%r[ansi(hc,Special Actions:)] [edit(sqlite_query(Game, Select Special From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),~,%b)]%r%r[ansi(hc,Description:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),9,1,|)] %r%r[printf($#3#&^78s,[ansi(hc,Method:)] [sqlite_query(Game, Select Method From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")] %t [ansi(hc,Type:)] [sqlite_query(Game, Select Type From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")] %t [ansi(hc,Range:)] [sqlite_query(Game, Select Range From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")] %r[ansi(hc,Access:)] [sqlite_query(Game, Select Author From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")] %t [ansi(hc,Author:)] [extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),13,1,|)])]%r%r[repeat([ansi(hb,-=)],39)]

&CMD`INSTRUCT #1215=$+instruct *=*:@assert nearby(%#,[pmatch(%1)])={@pemit %#=[prompt(Game)] The character you are trying to instruct is not present in the room.};@assert hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@pemit %#=[prompt(Game)] You do not possess the [caplist(%0,,,L)] jutsu.};@assert !hasattr([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)])={@pemit %#=[prompt(Game)] [name([pmatch(%1)])] already possess the [caplist(%0,,,L)] jutsu.};@assert gte(get([pmatch(%1)]/Dat`KP),[switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8)])={@pemit %#=[prompt(Game)] [name([pmatch(%1)])] does not have enough KP to learn the [caplist(%0,,,L)] jutsu from you at this time.};@assert gte(get([pmatch(%1)]/Dat`XP),[floor(mul(add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)]),[switch(1,[and([match(get([pmatch(%1)]/Dat`AffinityList),sqlite_query(Game, Select Type From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),|)],[match(Ninjutsu|Nintaijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get([pmatch(%1)]/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%#/Dat`Students),[if(match(get(%#/Dat`Students),[pmatch(%1)]),.1,0)],0)])],[and([match(get([pmatch(%1)]/Dat`AffinityList),Yang,|)],[match(Taijutsu|Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get([pmatch(%1)]/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%#/Dat`Students),[if(match(get(%#/Dat`Students),[pmatch(%1)]),.1,0)],0)])],[and([match(get([pmatch(%1)]/Dat`AffinityList),Yin,|)],[match(Seals|Calligraphy,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),|)])],[sub(.75,[if(match([regeditall(get([pmatch(%1)]/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%#/Dat`Students),[if(match(get(%#/Dat`Students),[pmatch(%1)]),.1,0)],0)])],1)]))])={@pemit %#=[prompt(Game)] [name([pmatch(%1)])] does not have enough XP to learn the [caplist(%0,,,L)] jutsu from you at this time.};@assert [u(#1215/Func`ExpertSpecCon,%0,%1)]={@pemit %#=[prompt(Game)] [name([pmatch(%1)])] is does not have the Specialties training necessary to be taught the [caplist(%0,,,L)] jutsu at this time.};@assert if(match(sqlite_query(Game, select Author from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]"),General),1,match(sqlite_query(Game, select Author from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]"),get([pmatch(%1)]/Dat`Clan),|))={@pemit %#=[prompt(Game)] [name([pmatch(%1)])] is not part of a clan capable of learning this jutsu. };@eval [t([setq(0,[pmatch(%1)])])];@pemit %#=[prompt(game)] You have offered to instruct [ansi(y, [name(%q0)])] in the usage of the [caplist(%0,,,L)] jutsu.;@pemit %q0=[prompt(game)] [ansi(c, %N)] wants to instruct you in thier [ansi(hy,caplist(%0,,,L))] Jutsu. %r%rType [ansi(hg, +lesson/review)] to look at the jutsu being offered and it's costs. Type [ansi(hg, +lesson/accept)] or [ansi(hg, +lesson/decline)] to accept or decline the jutsu instruction.;&dat`Jutsushower %q0=%#|%0

&CMD`INSTRUCT-RESPONSE #1215=$^\+lesson/(accept|decline)$:@break [hasattr(%#, dat`jutsushower)]={@break [strmatch(%1, accept)]={@pemit [extract(get(%#/Dat`JutsuShower),1,1,|)]=[prompt(game)] [ansi(y, [cname(%#)])] has accepted the instruction in your [extract(get(%#/Dat`JutsuShower),2,1,|)] jutsu.;@pemit %#=[prompt(Game)] You have accepted instruction in [ansi(c,name(extract(get(%#/Dat`JutsuShower),1,1,|)))]'s [extract(get(%#/Dat`JutsuShower),2,1,|)] jutsu for [u(#1215/Func`InstructXpCost,[extract(get(%#/Dat`JutsuShower),1,1,|)],[extract(get(%#/Dat`JutsuShower),2,1,|)])] XP and [switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8)] KP.;@set %#=dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]:[get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)])];@set %#=Dat`XP:[sub(get(%#/Dat`XP),[u(#1215/Func`InstructXpCost,[extract(get(%#/Dat`JutsuShower),1,1,|)],[extract(get(%#/Dat`JutsuShower),2,1,|)])])];@set %#=Dat`KP:[sub(get(%#/Dat`KP),[switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8)])];&dat`jutsushower %#=};@pemit %#=[prompt(game)] You have [ansi(r, declined)] to learn [ansi(c, [name([extract(get(%#/Dat`JutsuShower),1,1,|)])])]'s [extract(get(%#/Dat`JutsuShower),2,1,|)] jutsu.;@pemit [extract(get(%#/Dat`JutsuShower),1,1,|)]=[prompt(game)] [ansi(y, %N)] has [ansi(r, declined)] to learn your [extract(get(%#/Dat`JutsuShower),2,1,|)] jutsu.;&dat`jutsushower %#=};@pemit %#=[prompt(game)] No one is attempting to instruct you in a jutsu.
@set #1215/CMD`INSTRUCT-RESPONSE = regexp

	&FUNC`INSTRUCTXPCOST #1215=[floor(mul(add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,1,|)]"),[switch([extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)]),[switch(1,[t(and([match(get(%#/Dat`AffinityList),sqlite_query(Game, Select Type From Templates Where ID="[extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,1,|)]"),|)],[match(Ninjutsu|Nintaijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,1,|)]"),|)]))],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%0/Dat`Students),[if(match(get(%0/Dat`Students),%#),.1,0)],0)])],[t(and([match(get(%#/Dat`AffinityList),Yang,|)],[match(Taijutsu|Bukijutsu,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,1,|)]"),|)]))],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%0/Dat`Students),[if(match(get(%0/Dat`Students),%#),.1,0)],0)])],[t(and([match(get(%#/Dat`AffinityList),Yin,|)],[match(Seals|Calligraphy,sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%0/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,1,|)]"),|)]))],[sub(.75,[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)],[if(hasattr(%0/Dat`Students),[if(match(get(%0/Dat`Students),%#),.1,0)],0)])],[t(match(get(%0/Dat`Students),%#))],.9,1)]))]

&CMD`RETRAINJUTSU #1215=$+Jutsu/retrain *:@break [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Game)] You cannot purchase things while in Order.%r};@assert gte(get(%#/Dat`KP),1)={};@assert hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@pemit %#=[prompt(Game)] You do not possess the [caplist(%0,,,L)] jutsu.};@break match(get(%#/Dat`CopyList),extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),8,1,|),|)={[prompt(Game)] You cannot retrain a jutsu that is merely a copy.};@eval [iter(1|2|3|4|5|6,[set(%#,Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),##,1,|)])],|)];@set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,4,3,8,4,13,5,18,6,24)],|)];@set %#=Dat`KP:[sub(get(%#/Dat`KP),1)] ;@pemit %#=[prompt(Game)] You have retrained the [caplist(%0,,,L)] jutsu, returning the appropriate amount of Mastery Points([switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,4,3,8,4,13,5,18,6,24)]) for your Proficiency level. You have [get(%#/Dat`KP)] KP remaining

&CMD`FORGETJUTSU #1215=$+Jutsu/forget *:@assert hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@pemit %#=[prompt(Game)] You do not possess the [caplist(%0,,,L)] jutsu.};@break match(get(%#/Dat`CopyList),extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),8,1,|),|)={[prompt(Game)] You cannot forget a jutsu that is merely a copy.};@set %#=Dat`XP:[add(get(%#/Dat`XP),[setr(+,[if(hasattr(%#/Dat`NPC),0,[add([switch(extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|),1,0,2,1000,3,3000,4,6000,5,10000,6,15000)],[floor(mul([sqlite_query(Game, Select XP From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],[sub(switch(1,and([match(get(%#/Dat`AffinityList),[sqlite_query(Game, Select Type From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],|)],[match(Ninjutsu|Nintaijutsu|Chakra Flow Taijutsu|Chakra Flow Bukijutsu,[sqlite_query(Game, Select Archetype From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],|)]),.75,and([match(get(%#/Dat`AffinityList),Yang,|)],[match(Taijutsu|Bukijutsu,[sqlite_query(Game, Select Archetype From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],|)]),.75,and([match(get(%#/Dat`AffinityList),Yin,|)],[match(Seals|Calligraphy,[sqlite_query(Game, Select Archetype From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],|)]),.75,1),[if(match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Elite Tradition,|),.05,0)])]))])])],XP)])]; @pemit %#=[prompt(Game)] You have forgotten the [caplist(%0,,,L)] jutsu, recovering %q<XP> XP and removing the jutsu from your character. ; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]: ; @cemit monitor-app= [prompt(Forget)] %N has forgotten the [caplist(%0,,,L)] jutsu, recovering %q<XP> XP and removing the jutsu from their character. 

&CMD`FORGETTF #1215=$+TF/forget *:@assert match(get(%#/Dat`TFList),%0,|)={@pemit %#=[prompt(Game)] You do not possess the [caplist(%0,,,L)] Transformation.};@set %#=Dat`XP:[add(get(%#/Dat`XP),[setq(+,[if(hasattr(%#/Dat`NPC),0,[add(10000,[switch(get(%#/Dat`TFRank`[edit(%0,%b,-)]),0,0,1,2500,2,5000,3,7500,0)])])],XP)])]; @pemit %#=[prompt(Game)] You have forgotten the [caplist(%0,,,L)] Transformation, recovering %q<XP> XP and removing the Transformation from your character. ; @set %#=Dat`TFList:[remove(get(%#/Dat`TFlist),[grab(get(%#/Dat`TFList),%0,|)],|)]; @cemit monitor-app= [prompt(Forget)] %N has forgotten the [caplist(%0,,,L)] Transformation, recovering %q<XP> XP and removing the Transformation from their character.
@set App System/CMD`FORGETTF = no_command

&CMD`RETAIN #1215=$+Retain *:@assert match(get(%#/Dat`TFList),Sharingan,|)={@pemit %#=[prompt(Game)] You are not capable of retaining copied jutsu.};@assert strmatch(get(%#/Dat`Copylist,%0,|))={@pemit %#=[prompt(Game)] You do not have the [caplist(%0,,,L)] jutsu copied.};@assert gte(get(%#/Dat`XP),[add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])])={@pemit %#=[prompt(Game)] You do not have enough XP([add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])]) to retain the [caplist(%0,,,L)] jutsu.};@assert gte(get(%#/Dat`KP),[max(sub(switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])={@pemit %#= [prompt(Game)] You do not have enough KP%([max(sub(switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)]%) to retain the [caplist(%0,,,L)] jutsu.};@set %#=Dat`XP:[sub(get(%#/Dat`XP),[add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])])]; @set %#=Dat`KP:[sub(get(%#/Dat`KP),[max(sub(switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])] ;@pemit %#=[prompt(Game)] You have chosen to retain the [caplist(%0,,,L)] jutsu for [add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])] XP and [max(sub(switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)] KP[if([match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],%b%(Elite Tradition%),)]. You have [get(%#/Dat`XP)] XP and [get(%#/Dat`KP)] KP remaining. ; @cemit monitor-app=[prompt(Game)] %N has chosen to retain the [caplist(%0,,,L)] jutsu for [add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])] XP and [max(sub(switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,2,D,3,C,4,B,6,A,7,S,8),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)] KP[if([match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],%b%(Elite Tradition%),)]. ; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])]; @set %#=Dat`CopyList:[remove(get(%#/Dat`Copylist),%0,|)]

--------------------------------[ TC Stuff ]---------------------------------

&CMD`TCCREATESHOW #1215=$+app/TC:@pemit %#=%r%t%t%t%t Transcendence Creator %r%r1. Name: [extract(get(%#/Dat`TCCreate),7,1,|)] %r2. Clan: [extract(get(%#/Dat`TCCreate),6,1,|)] %r3. Description: [extract(get(%#/Dat`TCCreate),8,1,|)] %r4. First Ability: [extract(get(%#/Dat`TCCreate),1,1,|)] %r5. Second Ability: [extract(get(%#/Dat`TCCreate),2,1,|)] %r6. Third Ability: [extract(get(%#/Dat`TCCreate),3,1,|)] %r7. Fourth Ability: [extract(get(%#/Dat`TCCreate),4,1,|)] %r8. Fifth Ability: [extract(get(%#/Dat`TCCreate),5,1,|)] %r9. First Negative: [extract(get(%#/Dat`TCCreate),9,1,|)] %r10. Second Negative: [extract(get(%#/Dat`TCCreate),10,1,|)] %r11. Third Negative: [extract(get(%#/Dat`TCCreate),11,1,|)]

&LIST`TCABILITIES #1215=Fire Empowerment|Water Empowerment|Wind Empowerment|Earth Empowerment|Lightning Empowerment|Shockwave Empowerment|Plasma Empowerment|Lava Empowerment|Boil Empowerment|Ice Empowerment|Explosion Empowerment|Storm Empowerment|Scorch Empowerment|Wood Empowerment|Magnet Empowerment|Yin Empowerment|Yang Empowerment|Taijutsu Empowerment|Genjutsu Empowerment|Genjutsu Domination|Body Augmentation|Clone Enhancement|Pet Link|Extreme Senses|Extreme Subtly|Passive Regen|Seal Enhancement|Attrition Enhancement|Consumption Enhancement|Chakra Redirection Enhancement|Disruption Enhancement|Onslaught Enhancement|Counter Offensive Enhancement|Defensive Enhancement|Accuracy Enhancement|Power Enhancement|Medical Enhancement|Intensify Taijutsu|Intensify Ninjutsu|Intensify Genjutsu|Intensify Power|Intensify Speed|Intensify Stamina|Intensify Intelligence|Intensify Seal|Susanoo|Glimpse of Omniscience|All Creation|Extradimensional Form

&LIST`TCNEGATIVES #1215=Major Vitality Drain|Major Chakra Drain|Major Stamina Drain|Minor Vitaltiy Drain|Minor Chakra Drain|Minor Stamina Drain|Major Berserker|Death Wish|Nature Chakra|Susanoo Upkeep|Entropy

&CMD`TCCREATE #1215=$+app/TC *=*:@assert or([match(Name|name,%0,|)],[match(Clan|clan,%0,|)],[match(Description|description|Desc|desc,%0,|)],[match(get(#1215/List`TCAbilities),%1,|)],[match(get(#1215/List`TCNegatives),%1,|)])={@pemit %#=[prompt(System)] You have entered an improper TC Category, Ability, or Negative selection. };@assert or([match(Name|name,%0,|)],[match(Clan|clan,%0,|)],[match(Description|description|Desc|desc,%0,|)],and(t(grab(Ability 1|Ability 2|Ability 3|Ability 4|Ability 5|Negative 1|Negative 2|Negative 3,%0,|)),or(match(get(#1215/List`TCAbilities),%1,|),match(get(#1215/List`TCNegativess),%1,|))))={@pemit %#=[prompt(System)] That attribute is already part of the TC being created.};@assert t(grab(Ability 1|Ability 2|Ability 3|Ability 4|Ability 5|Clan|Name|Description|Negative 1|Negative 2|Negative 3,%0,|))={@pemit %#=[prompt(System)] %0 is not a proper category for the Transcendence Creator. Please use +App/TC to see the categories.};@assert if(match(Name,%0,|),and(gte(strlen(%1),3),lte(strlen(%1),25)),1)={@pemit %#=[prompt(System)] You need to adjust the length of the Name of this TC to between 3 and 25 characters.};@assert if(match(Description,grab(Description,%0*,|),|),and(gte(strlen(%1),200),lte(strlen(%1),2000)),1)={@pemit %#=[prompt(System)] You need to adjust the length of the Description of this TC to between 200 and 2000 characters.};@assert if(match(Clan,%0,|),match(get(%#/Dat`Clan)|None,%1,|),1)={@pemit %#=[prompt(System)] You cannot create a TF for a Clan you are not a part of. If you are not in a Clan, use 'None'.};@assert if(match(Negative 1|Negative 2|Negative 3,%0,|),!match(get(#1215/List`TCNegatives),[caplist(%1,,,L)],|),1)={@pemit %#=[prompt(System)] You must select proper negatives for this TC.}; @eval [if(!hasattr(%#/Dat`TCCreate),[set(%#,Dat`TCCreate:|||||None||||||1)])] [if(match(Ability 1|Ability 2|Ability 3|Ability 4|Ability 5,%0*,|),[set(%#,Dat`TCCreate:[replace(get(%#/Dat`TCCREATE),[switch(1,[strmatch(Ability 1,%0)],1,[strmatch(Ability 2,%0)],2,[strmatch(Ability 3,%0)],3,[strmatch(Ability 4,%0)],4,[strmatch(Ability 5,%0)],5,[strmatch(Negative 1,%0)],9,[strmatch(Negative 2,%0)],10,[strmatch(Negative 3,%0)],11)],[grab(get(#1215/List`TCAbilities)|get(#1215/List`TCNegatives),%1,|)],|)])][pemit(%#,[prompt(System)] You have assigned [caplist(%1,,,L)] to [caplist(%0,,,L)].%r)])] [if(and(match(Name,%0,|),gte(strlen(%1),3),lte(strlen(%1),25)),[set(%#,Dat`TCCreate:[replace(get(%#/Dat`TCCreate),7,[caplist(%1,,,L)],|)])][pemit(%#,[prompt(System)] You have set the Name of the TF being created to '[caplist(%1,,,L)]'.%r)])][if(match(Description,grab(Description,%0*,|),|),[set(%#,Dat`TCCreate:[replace(get(%#/Dat`TCCreate),8,[capstr(%1)],|)])][pemit(%#,[prompt(System)] You have set the Description of the TF being created to:%r%r '[capstr(%1)]'%r)])][if(and(match(Clan,%0,|),match(get(%#/Dat`Clan)|None,%1,|)),[set(%#,Dat`TCCreate:[replace(get(%#/Dat`TCCreate),6,[caplist(%1,,,L)],|)])][pemit(%#,[prompt(System)] You have set the Clan of the TF being created to '[caplist(%1,,,L)]'.%r)])]

------------------------------[ Etc Functions ]------------------------------

&FUNC`EXPERTSPECCON #1215=[and(eq([words([setinter([elements(Targeted Powerful Disrupt Flurry|Barrage Charge Feint DoT Absorb Drain Counter|Clash Collab Block|Turtle Barrier Reflection Evade|Avoid, [iter([regeditall(get([pmatch(%1)]/dat`ExpertiseList), %\^%[012%],)], [match(Targeted|Powerful|Disruption|Onslaught|Chakra Flow|Ambidexterity|Attrition|Chakra Absorption|Chakra Drain|Counter Offensive|Synchronized Effort|Fortification|Barrier|Reflection|Evasive Maneuvers, ##, |)], |)],%b,|)], [edit(sqlite_query(Game, select Special from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]"),~,|)], |)],|)], [words([trim([sqlite_query(Game, select Special from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")], r, ~)], ~)]),[if(match([sqlite_query(Game, select Type from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")],Physical),1,[words(setinter([elements(Fire Water Wind Earth Lightning Yin Yang Combination, [iter([regeditall(get([pmatch(%1)]/dat`ExpertiseList), %\^%[012%],)], [match(Nature Transformation: Fire|Nature Transformation: Water|Nature Transformation: Wind|Nature Transformation: Earth|Nature Transformation: Lightning|Nature Transformation: Yin|Nature Transformation: Yang|Combination Element: *, ##, |)], |)],%b,|)], [sqlite_query(Game, select Type from Templates where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")], |),|)])])]

&FUNC`PRECISIONMINROLL #1215=Ceil(MUL([u(#1215/Func`PrecisionMaxRoll,%0,%1)],ADD(0.45,fDIV(add([extract(u(%#/Dat`TranscendAttribs),[switch(sqlite_query(Game, Select Category From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),Taijutsu,1,Ninjutsu,2,Genjutsu,3)],1,|)],[extract(u(%#/Dat`PrimaryStats),[switch(sqlite_query(Game, Select Category From Templates Where ID="[extract(get([extract(get(%#/Dat`JutsuShower),1,1,|)]/Dat`JutsuAttributes`[edit([extract(get(%#/Dat`JutsuShower),2,1,|)],%b,-)]),7,1,|)]"),Taijutsu,1,Ninjutsu,2,Genjutsu,3)],1,|)]),100),fDIV(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),1,1,|)],[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.8)),1.25,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.5)),1,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),0.85,[IF(LT(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),1.3)])])])]),100))))

&FUNC`PRECISIONMAXROLL #1215=Ceil(MUL(mul([u(#1215/Func`PrecisionMod,%0,%1)],.75),MUL(Add(1,mul([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),1,1,|)],.1)),[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.8)),1.25,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.5)),1,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),0.85,[IF(LT(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),1.3)])])])])))

&FUNC`POTENCYMINROLL #1215=Ceil(MUL([u(#1215/Func`PotencyMaxRoll,%0,%1)],ADD(0.45,fDIV(add([extract(u(%#/Dat`PrimaryStats),4,1,|)],[extract(u(%#/Dat`TranscendAttribs),4,1,|)]),100),fDIV(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.8)),1.15,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.5)),1,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),0.85,[IF(LT(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),1.25)])])])]),100))))

&FUNC`POTENCYMAXROLL #1215=Ceil(MUL(mul([u(#1215/Func`PotencyMod,%0,%1)],[switch([sqlite_query(Game, Select Rank From Templates where ID=[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],E,3,D,4,C,5,B,6,A,7,S,8)]),Mul(ADD(1,MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],.1)),[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.8)),1.15,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.5)),1,[IF(GTE(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),0.85,[IF(LT(ceil(mul(add(get(%#/Dat`Vitality`Current),get(%#/Dat`Stamina`Current)),.5)),MUL([get(%#/Dat`PhysicalEnergy`Max)],0.3)),1.25)])])])])))

&FUNC`EFFICIENCYMOD #1215=ADD(MUL(MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`%0),4,1,|)],IF(GTE(get(%#/Dat`PhysicalEnergy`Current),MUL(get(%#/Dat`PhysicalEnergy`Total),0.75)),1.25,IF(GTE(get(%#/Dat`PhysicalEnergy`Current),MULTIPLY(get(%#/Dat`PhysicalEnergy`Total),0.5)),1,0.75))),IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select Efficiency From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),.75,.25),1)),0.043),fdiv(add([extract(u(%#/Dat`PrimaryStats),6,1,|)],[extract(u(%#/Dat`TranscendAttribs),6,1,|)]),75))

&FUNC`FORMMOD #1215=CEIL(fDiv(ADD(MUL(add([extract(u(%#/Dat`TranscendAttribs),5,1,|)],[extract(u(%#/Dat`PrimaryStats),5,1,|)]),0.2),MUL(MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`%0),3,1,|)],IF(GTE([get(%#/Dat`PhysicalEnergy`Current)],MUL([get(%#/Dat`PhysicalEnergy`Total)],0.75)),1.25,IF(GTE([get(%#/Dat`PhysicalEnergy`Current)],MUL([get(%#/Dat`PhysicalEnergy`Total)],0.5)),1,0.75))),IF(hasattr(%#/Dat`TF),IF(Match([sqlite_query(Game, Select Form From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.25,.75),1)),0.4)),-1))

&FUNC`EFFECTIVENESSMOD #1215=round(MUL(MUL(ADD([extract(u(%#/Dat`PrimaryStats),7,1,|)],[extract(u(%#/Dat`TranscendAttribs),7,1,|)]),0.01),MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`%0),5,1,|)],IF(GTE(get(%#/Dat`SpiritualEnergy`Current),MUL(get(%#/Dat`SpiritualEnergy`Total),0.75)),1.25,IF(GTE(get(%#/Dat`SpiritualEnergy`Current),MUL(get(%#/Dat`SpiritualEnergy`Total),0.5)),1,0.75))),IF(match(extract(get(%#/Dat`TransformAttribs),5,1,|),Yes),1.5,1))),2)

&FUNC`ADAPTABILITYMOD #1215=round(ADD(MUL(.075,MUL(MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),6,1,|)],IF(GTE(get(%#/Dat`SpiritualEnergy`Current),MUL(get(%#/Dat`SpiritualEnergy`Total),0.75)),1.25,IF(GTE(get(%#/Dat`SpiritualEnergy`Current),MUL(get(%#/Dat`SpiritualEnergy`Total),0.5)),1,0.75))),IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select Adaptability From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.5,.75),1)),0.5)),MUL(ADD([extract(u(%#/Dat`PrimaryStats),8,1,|)],[extract(u(%#/Dat`TranscendAttribs),8,1,|)]),0.01)),2)

&FUNC`PENMOD #1215=IF(hasattr(%#/Dat`TF),IF(Match([sqlite_query(Game, Select Pen From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),[fdiv(75,100)],),0)

&FUNC`DRMOD #1215=IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select DR From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.5,),1)

&FUNC`PRECISIONMOD #1215=CEIL(Mul(MUL([extract(get(#254/Dat`JutsuRanks`Base),[switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,1,D,2,C,3,B,4,A,5,S,6)],1,|)],ADD(MUL(0.05,add([extract(get(%#/Dat`PrimaryStats),[switch([sqlite_query(Game, Select Category From Templates Where ID="[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu,1,Ninjutsu,2,Genjutsu,3)],1,|)],[extract(get(%#/Dat`TranscendAttribs),[switch([sqlite_query(Game, Select Category From Templates Where ID="[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu,1,Ninjutsu,2,Genjutsu,3)],1,|)])),1)),[if(match([sqlite_query(Game, Select Precision From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.2,1)]))

&FUNC`POTENCYMOD #1215=CEIL(MUL(MUL([extract(get(#254/Dat`JutsuRanks`Base),[switch([sqlite_query(Game, Select Rank From Templates Where ID="[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],E,1,D,2,C,3,B,4,A,5,S,6)],1,|)],ADD(MUL(0.05,add([extract(u(%#/Dat`PrimaryStats),4,1,|)],[extract(u(%#/Dat`TranscendAttribs),4,1,|)])),1)),[if(match([sqlite_query(Game, Select Potency From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.2,1)]))

&FUNC`EXPERTSPECCOPY #1215=[and(eq([words([setinter([elements(Targeted Powerful Disrupt Flurry|Barrage Charge Feint DoT Absorb Drain Counter|Clash Barrier Reflection Block|Turtle Evade|Avoid, [iter([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)], [match(Targeted|Powerful|Disruption|Onslaught|Chakra Flow|Ambidexterity|Attrition|Chakra Absorption|Chakra Drain|Counter Offensive|Barrier|Reflection|Fortification|Evasive Maneuvers, ##, |)], |)],%b,|)], [edit(sqlite_query(Game, select Special from Templates where ID="[elements(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]"),~,|)], |)],|)], [words([trim([sqlite_query(Game, select Special from Templates where ID="[elements(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")], r, ~)], ~)]),[if(match([sqlite_query(Game, select Type from Templates where ID="[elements(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")],Physical),1,[words(setinter([elements(Fire Water Wind Earth Lightning Yin Yang Combination, [iter([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)], [match(Nature Transformation: Fire|Nature Transformation: Water|Nature Transformation: Wind|Nature Transformation: Earth|Nature Transformation: Lightning|Nature Transformation: Yin|Nature Transformation: Yang|Combination Element: *, ##, |)], |)],%b,|)], [sqlite_query(Game, select Type from Templates where ID="[elements(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,|)]")], |),|)])])]

&FUNC`COMBOMPEXPERT #1215=[if([match(get(%#/Dat`ExpertiseList),Combination Element: Plasma*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Fire*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Lightning*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Lava*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Fire*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Earth*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Boil*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Fire*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Water*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Scorch*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Fire*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Wind*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Explosion*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Lightning*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Earth*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Storm*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Lightning*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Water*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Shockwave*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Lightning*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Wind*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Wood*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Water*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Earth*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Magnet*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Wind*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Earth*,|)],1,|),^)]),2)],[if([match(get(%#/Dat`ExpertiseList),Combination Element: Ice*,|)],[div(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Water*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: Wind*,|)],1,|),^)]),2)])])])])])])])])])])]

&FUNC`CATEXPERT #1215=[ladd([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),1,6,|)]|[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,1,|)]|[u(#1215/Func`CatExpertSort,%0)],|)]

&FUNC`CATEXPERTSORT #1215=[if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu),[if(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Chakra Flow Taijutsu),[if(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Bukijutsu),[if(match(get(%#/Dat`ExpertiseList),Armament*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Armament*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Chakra Flow Bukijutsu),[if(match(get(%#/Dat`ExpertiseList),Armament*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Armament*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Seal),[if(match(get(%#/Dat`ExpertiseList),Seal Manifestation*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Seal Manifestation*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Calligraphy),[if(match(get(%#/Dat`ExpertiseList),Calligraphy Conjuration*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Calligraphy Conjuration*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Combination),[if(match(get(%#/Dat`ExpertiseList),Combination Element:*,|),[switch([u(#1215/Func`ComboMPExpert)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Ninjutsu),[if(match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Nintaijutsu),[if(or(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)),[switch(if(gte([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)]),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)]),0,0,1,6,2,12)])])]
