Uncategorized Bug Fixes 

/// Jutsu Display Code (#60): Mitigation Display ///

&CMD`JUTSUDISPLAY #60=$+Jutsu *:@assert hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@pemit %#=[prompt(Game)] You do not have the [caplist(%0,,,L)] Jutsu.};@eval [if(lt([ladd([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),1,6,|)]|[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,1,|)],|)],[add(switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,6,2,10,3,14,4,19,5,24,6,30),[u(#1215/Func`CatExpertSort,%0)])]),[set(%#,Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,[add([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,1,|)],[switch(u(#1215/Func`CatExpertSort,%0),6,6,12,6,0)])],|)])],)] ;@pemit %#=[printf($:[ansi(hb,-=)]:^78s,[ansi(hb,\[)]%b[ansi(hw,+jutsu %0)]%b[ansi(hb,\])])]%r%r[printf($#3#&^78s,[ansi(hg,[extract([get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])],12,1,|)])] [extract([get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])],8,1,|)] \([extract([get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])],11,1,|)]\))] %r[printf($#3#&^78s,[ansi(hc,Rank:)] [sqlite_query(Game, Select Rank From Templates Where ID="[extract([get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])],7,1,|)]")] %t%t [ansi(hc,XP:)] [add(sqlite_query(Game, Select XP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,3000,4,6000,5,10000,6,15000)])])] %r%r [printf($#3#&^78s,[ansi(hc,Stamina:)] [ceil(sub(sqlite_query(Game, Select Stamina From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),mul(sqlite_query(Game, Select Stamina From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[u(#253/func`efficiencymod,[edit(%0,%b,-)])])))] %t [ansi(hc,Chakra:)] [ceil(sub(sqlite_query(Game, Select Chakra From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),mul(sqlite_query(Game, Select Chakra From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),[u(#253/func`efficiencymod,[edit(%0,%b,-)])])))] %t [ansi(hc,AP:)] [if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Defend),0,[max(add(sqlite_query(Game, Select AP From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),add([u(#253/func`formmod,[edit(%0,%b,-)])],[if([extract(get(%#/Dat`Link),2,1,|)],1)])),[switch(1,[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),E,1,D,1,C,1,B,2,A,2,S,3)],[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Ninjutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),E,1,D,2,C,3,B,3,A,4,S,4)])])])] \(Min:[if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Attack),switch(1,[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),E,1,D,1,C,1,B,2,A,2,S,3)],[if(match([sqlite_query(Game, Select Category From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Ninjutsu),1)],[switch(sqlite_query(Game, Select Rank From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),E,1,D,2,C,3,B,3,A,4,S,4)]),0)]\))] %r%r[printf($#3#&^78s,[ansi(hy,Proficiency Level:)] [switch([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)],1,Novice,2,Practitioner,3,Adept,4,Skilled,5,Expert,6,Master)]\([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),14,1,|)]\) %t [ansi(hy,Mastery Points:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),15,1,|)])] %r%r[printf($#3#&^78s,[ansi(hc,Precision:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),1,1,|)] \([u(#253/Func`PrecisionMinRoll,[edit(%0,%b,-)])]-[u(#253/Func`PrecisionMaxRoll,[edit(%0,%b,-)])]\) %t [ansi(hc,Potency:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)] \([if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Attack),[ceil(mul(u(#253/func`potencyminroll,[edit(%0,%b,-)]),[switch([sqlite_query(Game, Select Archetype From Templates where ID=[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Taijutsu,1,Bukijutsu,1.5,Chakra Flow Taijutsu,1.75,Chakra Flow Bukijutsu,2,Ninjutsu,3,Seal,3,Calligraphy,2,Nintaijutsu,2.5,Combination,3.5,Tota,4)]))]-[ceil(mul(u(#253/func`potencymaxroll,[edit(%0,%b,-)]),[switch([sqlite_query(Game, Select Archetype From Templates where ID=[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Taijutsu,1,Bukijutsu,1.5,Chakra Flow Taijutsu,1.75,Chakra Flow Bukijutsu,2,Ninjutsu,3,Seal,3,Calligraphy,2,Nintaijutsu,2.5,Combination,3.5,Tota,4)]))],-[add(ceil(mul([u(#253/Func`PotencyMod,%0)],add(1,mul([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],.1)))),[if(and(hasattr(%#/Dat`BodyMod),match(Kaguya,[get(%#/Dat`Clan)],|)),add(mul([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Body Mod*,|)],1,|),^,1)],25),25),0)])])]\) %r[ansi(hc,Form:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),3,1,|)] \([u(#253/Func`FormMod,[edit(%0,%b,-)])] AP\) %t%t [ansi(hc,Efficiency:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),4,1,|)] \([ceil(mul(u(#253/Func`EfficiencyMod,[edit(%0,%b,-)]),100))]\%\) %r[ansi(hc,Effectiveness:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),5,1,|)] \([ceil(mul(u(#253/Func`EffectivenessMod,[edit(%0,%b,-)]),100))]\%\) %t [ansi(hc,Adaptability:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),6,1,|)] \([mul(u(#253/Func`AdaptabilityMod,[edit(%0,%b,-)]),100)]\%\))] %r%r[printf($#3#&^78s,[ansi(hr,Mitigation:)] [if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Attack),0,[ceil(mul(add(get(%#/Dat`Mit),IF(hasattr(%#/Dat`TF),IF(Match([sqlite_query(Game, Select Mit From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),[add(.2,mul([u(#253/Func`EffectivenessMod,%0)],.75))],[add(.1,mul([u(#253/Func`EffectivenessMod,%0)],.75))]),[add(.1,mul([u(#253/Func`EffectivenessMod,%0)],.75))])),100))])]\% %t [ansi(hr,Penetration:)] [ceil(mul(u(#253/Func`PenMod),100))]\% %t [ansi(hr,Damage Reduction:)] [if(match([sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Attack),0,[if(match([sqlite_query(Game, Select Special From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Barrier,~),[ceil(mul(match(get(#254/Dat`JutsuRanks),[sqlite_query(Game, Select Rank From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`%0),7,1,|)]")],|),ceil(mul(750,[u(#253/Func`DRMod)]))))],0)])])] %r%r[ansi(hc,Special Actions:)] [edit(sqlite_query(Game, Select Special From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"),~,%b)]%r%r[ansi(hc,Description:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),9,1,|)] %r%r[printf($#3#&^78s,[ansi(hc,Method:)] [sqlite_query(Game, Select Method From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %t [ansi(hc,Type:)] [sqlite_query(Game, Select Type From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %t [ansi(hc,Range:)] [sqlite_query(Game, Select Range From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %r[ansi(hc,Category:)] [sqlite_query(Game, Select Category From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %t[ansi(hc,Archetype:)] [sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %r[ansi(hc,Access:)] [sqlite_query(Game, Select Author From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")] %t [ansi(hc,Author:)] [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),13,1,|)])]%r%r[repeat([ansi(hb,-=)],39)]

&FUNC`CATEXPERTSORT #1215=[if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Taijutsu),[if(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Chakra Flow Taijutsu),[if(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Bukijutsu),[if(match(get(%#/Dat`ExpertiseList),Armament*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Armament*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Chakra Flow Bukijutsu),[if(match(get(%#/Dat`ExpertiseList),Armament*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Armament*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Seal),[if(match(get(%#/Dat`ExpertiseList),Seal Manifestation*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Seal Manifestation*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Calligraphy),[if(match(get(%#/Dat`ExpertiseList),Calligraphy Conjuration*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Calligraphy Conjuration*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Combination),[if(match(get(%#/Dat`ExpertiseList),Combination Element:*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Combination Element:*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Ninjutsu),[if(match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|),[switch([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)],0,0,1,6,2,12)])])][if(match([sqlite_query(Game, Select Archetype From Templates Where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],Nintaijutsu),[if(or(match(get(%#/Dat`ExpertiseList),Martial Arts*,|),match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)),[switch(if(gte([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)]),[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Martial Arts*,|)],1,|),^)],[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Nature Transformation: [extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),10,1,|)]*,|)],1,|),^)]),0,0,1,6,2,12)])])]



&CMD`PROFICIENCYAPP #1215=$+buy/proficiency *:@break [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Game)] You cannot purchase things while in Order.%r};@break hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@break gte(get(%#/Dat`KP),[max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])={@break gte(get(%#/Dat`XP),[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,1000,2,2000,3,3000,4,4000,5,5000)])={@break lt([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],6)={ @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1)],|)] ;@set %#=Dat`XP:[sub(get(%#/Dat`XP),[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,2000,4,3000,5,4000,6,5000)])]; @set %#=Dat`KP:[sub(get(%#/Dat`KP),[max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)])]; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],[switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],2,4,3,4,4,5,5,5,6,6)])],|)];@pemit %#=[prompt(Game)] %N has increased the Jutsu Proficiency Level of [caplist(%0)] to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)], raising the amount of available Jutsu Mastery Points to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)] for [switch([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)],1,0,2,1000,3,2000,4,3000,5,4000,6,5000)] XP and [max(sub(3,[after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],1,|),^,1)]),1)] KP[if([match(get(%#/Dat`ExpertiseList),Elite Tradition*,|)],%b%(Elite Tradition%),)]. %r%r [get(%#/Dat`XP)] XP, and [get(%#/Dat`KP)] KP remain. ;@cemit monitor-app=[prompt(App)] %N has increased the Proficiency Level of their [caplist(%0,,,L)] jutsu to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),14,1,|)]. };@pemit %#=[prompt(Game)] %N has already achieved the maximum Proficiency Level for the [caplist(%0)] jutsu. };@pemit %#=[prompt(Game)] %N does not have enough XP. };@pemit %#=[prompt(Game)] %N does not have enough KP.}; @pemit %#=[prompt(Game)] %N does not have the [caplist(%0)] Jutsu.


&CMD`MASTERYAPP #1215=$+buy/mastery *=*:@break hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)])={@break match(get(#244/Dat`JutsuAttributes),%1,|)={@break lt([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)],10)={@break gt([extract(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],0)={@set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),15,[sub([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),15,1,|)],1)],|)]; @set %#=Dat`JutsuAttributes`[edit(%0,%b,-)]:[replace(get(%#/dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],[add([extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)],1)],|)]; @pemit %#=[prompt(Game)] %N has increased the [caplist(%1)] Mastery Level of [caplist(%0)] to [extract(get(%#/Dat`jutsuattributes`[edit(%0,%b,-)]),[match(get(#244/Dat`JutsuAttributes),%1,|)],1,|)]!};@pemit %#=[prompt(Game)] The [caplist(%0)] jutsu has no Mastery Points to spend. Increase Proficiency with the Jutsu or attain Expertise in it's Specialization to gain more points.};@pemit %#=[prompt(Game)] %N has already mastered [caplist(%1)] for the [caplist(%0)] Jutsu.%r}; @pemit %#=[prompt(Game)] [caplist(%1)] is not a Jutsu Attribute.%r}; @pemit %#=[prompt(Game)] %N does not have the [caplist(%0)] Jutsu.%r

&CMD`COPY #446=$+Copy *=*:@break [match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)]={@pemit %#=%r[prompt(Combat)] Your consciousness has been suppressed by that of [name([extract(get(%#/Dat`Control),1,1,|)])]. This prevents you from taking any action other than resisting or tensing. ;@remit %L=%r[Prompt(Combat)] Try as they might, the internal struggle over %N's consciousness remains futile under [name([extract(get(%#/Dat`Control),1,1,|)])]'s control. };@break hasattr(%#/Dat`Exposure)={@pemit %#=%r[prompt(Combat)] Your conciousness is no longer within your body. This prevents you from taking any actions outside of tensing. ;@remit %L=%r[Prompt(Combat)] Having projected their conciousness from their body, %N remains unconcious and exposed.};@break match(%#,[pmatch(%1)])={@pemit %#=%r[prompt(Combat)] You incapable of copying your own jutsu.};@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer attack.%r};@assert [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Combat)] You are not in order.%r};@assert eq([get(%l/player_turn)], [member([get(%l/list`players)], %#)])={@pemit %#=%r[prompt(Combat)] It is not your turn.%r};@assert nearby(%#,[pmatch(%0)])={@pemit %#=[prompt(Game)] The character you are trying to Copy from is not present in the room.};@assert match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Copy,|)={@pemit %#=[prompt(Combat)] You do not have an appropriate Specialty needed to Copy.};@assert !hasattr(%#/Dat`JutsuAttributes`[edit(%1,%b,-)])={@pemit %#=[prompt(Game)] You have already copied the [caplist(%1,,,L)] jutsu.};@assert [if(match(get(%#/Dat`TF),Kokuuzou,|),1,[u(#1215/Func`ExpertSpecCopy,%1,%0)])]={@pemit %#=[prompt(Game)] You do not have the Specialties training necessary to copy the [caplist(%1,,,L)] jutsu.};@assert if(match(sqlite_query(Game, select Author from Templates where ID="[elements(get([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]"),General),1,match(sqlite_query(Game, select Author from Templates where ID="[elements(get([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]"),get(%#/Dat`Clan),|))={@pemit %#=[prompt(Game)] You are not part of a clan capable of copying the [caplist(%0,,,L)] jutsu. };@break if(match(extract(get(%#/Dat`PerceptionCheck),3,1,|),[pmatch(%1)]),1,0)={@pemit %#=%r[prompt(Combat)] [name(*%1)] is no where to be found.};@assert gte(get(%#/Dat`AP`Current),4)={@pemit %#=[prompt(Combat)] You do not have enough AP to Copy a jutsu.};@assert gte(get(%#/Dat`Stamina`Current),ceil(mul(get(%#/Dat`Stamina`Total),.01)))={@pemit %#=[prompt(Combat)] You do not have enough Stamina to Copy a jutsu.};@set %#=Dat`AP`Current:[sub(get(%#/Dat`AP`Current),4)];@set %#=Dat`Stamina`Current:[sub(get(%#/Dat`Stamina`Current),ceil(mul(get(%#/Dat`Stamina`Total),.01)))];@IFELSE match(get(%#/Dat`TFList),Sharingan,|)={@IF match(get(%#/Dat`TF),Sharingan,|)=@eval [if(eq(rand(3),2),[if([hasattr([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])],[set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[get([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])])][set(%#,Dat`CopyList:[insert(get(%#/Dat`CopyList),-1,[caplist(%1)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),14,6,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),13,Copy,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),15,0,|)])][remit(%L,[prompt(Copy)] %N's [switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Copy*,|)],1,|),^),0,one tomoe,1,two tomoe,2,three tomoe)] Sharingan swirls rapidly around [poss(%#)] pupil as it successfully copies [name(*%0)]'s [caplist(%1)]!)],[pemit(%#,[Prompt(Copy)] [name(*%0)] does not have [caplist(%1)].)])],[Remit(%L,[prompt(Copy)] %N's [switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Copy*,|)],1,|),^),0,one tomoe,1,two tomoe,2,three tomoe)] Sharingan loses focus and fails to copy [name(*%0)]'s [caplist(%1,,,L)].)])],@pemit %#=[prompt(Copy)] You do not have Sharingan activated.};@IFELSE match(get(%#/Dat`TFList),Kokuuzou,|)={@IF match(get(%#/Dat`TF),Kokuuzou,|)=@eval [if(eq(rand(3),2),[if([hasattr([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])],[set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[get([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),1,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),2,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),3,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),4,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),5,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),6,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),14,1,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),15,0,|)])][remit(%L,[prompt(Copy)] %N's [switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Copy*,|)],1,|),^),0,vacuuous eyes fall upon,1,tenebrous gaze focuses on,2,abyssal glare divine)] [name(*%0)]%, instantly discerning the nature of their [caplist(%1)] jutsu!)],[pemit(%#,[Prompt(Copy)] [name(*%0)] does not have [caplist(%1)].)])],[Remit(%L,[prompt(Copy)] %N's [switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Copy*,|)],1,|),^),0,vacuuous eyes fail,1,tenebrous gaze fails,2,abyssal glare fails)] to interpret the complexities of [name(*%0)]'s [caplist(%1,,,L)].)])],@pemit %#=[prompt(Copy)] You do not have Kokuuzou activated.};@IFELSE and([match(get(%#/Dat`ExpertiseList),Copy*,|)],[!match([get(%#/Dat`TF)],Sharingan,|)],[!match([get(%#/Dat`TF)],Kokuuzou,|)])={@eval [if(eq(rand(3),2),[if([hasattr([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])],[set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[get([pmatch(%0)]/Dat`JutsuAttributes`[edit(%1,%b,-)])])][set(%#,Dat`CopyList:[insert(get(%#/Dat`CopyList),-1,[caplist(%1)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),1,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),2,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),3,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),4,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),5,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),6,[switch(after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),[switch([sqlite_query(Game, Select Archetype From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")],Taijutsu,Martial Arts*,Bukijutsu,Armament*,Ninjutsu,Nature Transformation: [sqlite_query(Game, Select Type From Templates Where ID="[elements(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),7,|)]")]*,Seal,Seal Manifestation*,Calligraphy,Calligraphy Conjuration)],|)],1,|),^),0,5,1,6,2,7)],|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),13,Copy,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),14,6,|)])][set(%#,Dat`JutsuAttributes`[edit(%1,%b,-)]:[replace(get(%#/Dat`JutsuAttributes`[edit(%1,%b,-)]),15,0,|)])][remit(%L,[prompt(Copy)] %N's concerted observations of [name(*%0)] has succeeded in allowing them to copy the [caplist(%1)] jutsu!)],[pemit(%#,[Prompt(Copy)] [name(*%0)] does not have [caplist(%1)].)])],[remit(%L,[prompt(Copy)] %N's concerted observations of [name(*%0)] has failed to copy the [caplist(%1)] jutsu.)])],@pemit %#=[prompt(Copy)] You do not have an appropriate Transformation activated.}





&CMD`BARRIER #446=$+Barrier *=*:@assert [strmatch(%#, [get(%l/dat`pt_player)])]={@pemit %#=[prompt(Game)] It's not your turn.}; @break [match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)]={@pemit %#=%r[prompt(Combat)] Your consciousness has been suppressed by that of [name([extract(get(%#/Dat`Control),1,1,|)])]. This prevents you from taking any action other than resisting or tensing. ;@remit %L=%r[Prompt(Combat)] Try as they might, the internal struggle over %N's consciousness remains futile under [name([extract(get(%#/Dat`Control),1,1,|)])]'s control. };@break hasattr(%#/Dat`Exposure)={@pemit %#=%r[prompt(Combat)] Your conciousness is no longer within your body. This prevents you from taking any actions outside of tensing. ;@remit %L=%r[Prompt(Combat)] Having projected their conciousness from their body, %N remains unconcious and exposed.};@break or([match([extract(get(%#/Dat`Control),2,1,|)],Nara)],and([match([extract(get([iter(%1, [locate(%#, ##, nP)])]/Dat`Control),2,1,|)],Nara)],[match([extract(get([iter(%1, [locate(%#, ##, nP)])]/Dat`Control),1,1,|)],%#)]))={@pemit %#=%r[prompt(Combat)] You are unable to take this action while Shadow Imitation Technique is activate on this target.};@assert or(hasattr(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),hasattr(%#/Dat`CopiedJutsu`[edit(%0,%b,-)]))={@pemit %#=[prompt(Game)] That is not a valid skill.}; @assert [match([sqlite_query(Game, select Special where ID='[elementsmux([get(%#/dat`jutsuattributes`[edit(%0, %b, -)])], 7, |)]')], Barrier, ~)]={@pemit %#=[prompt(game)] That is not a defensive jutsu that can use Barrier.};@assert [land([iter(%1, [t([locate(%#, ##, nP)])])])]={@pemit %#=[prompt(Game)] Not all players are valid.};@assert lte(words(iter(%1, [if([t(locate(%#, ##, nP))], [locate(%#, ##, nP)])])), [add(3, [after(grab([get(%#/dat`expertiseList)], Barrier*, |), ^)])])={@pemit %#=[prompt(game)] Too many players.}; @assert gte(get(%#/dat`stamina`current), setr(+, ceil(mul(mul(Sub([sqlite_query(Game, Select Stamina From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`%0),7,1,|)]")],mul([sqlite_query(Game, Select Stamina From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`%0),7,1,|)]")],[u(#253/func`efficiencymod,%0)])),[if(hasattr(%#/Dat`Link),2,1)]),[sub(mul(add(words(%1),2),.8),[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])])), StamCost))={@pemit %#=[prompt(game)] You don't have enough stamina.}; @assert gte(get(%#/dat`Chakra`current), setr(+, ceil(mul(mul(Sub([sqlite_query(Game, Select Chakra From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`%0),7,1,|)]")],mul([sqlite_query(Game, Select Chakra From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`%0),7,1,|)]")],[u(#253/func`efficiencymod,%0)])),[if(hasattr(%#/Dat`Link),2,1)]),[sub(mul(add(words(%1),2),.8),[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])])), ChakraCost))={@pemit %#=[prompt(game)] You don't have enough stamina.}; @assert gte(get(%#/Dat`AP`Current),add([sqlite_query(Game, Select AP From Templates where ID=[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],add([u(#253/func`formmod,[edit(%0,%b,-)])],[if([extract(get(%#/Dat`Link),2,1,|)],1)]),4))={@pemit %#=%r[prompt(Combat)] You do not have enough AP.}; @eval [setq(+, [ceil(mul(match(get(#254/Dat`JutsuRanks),[sqlite_query(Game, Select Rank From Templates where ID="[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")],|),ceil(mul(mul(500,add([u(#253/Func`EffectivenessMod,%0)],1)),[u(#253/Func`DRMod,[edit(%0,%b,-)])]))))], BarrierHealth)][setq(+, [listunion([iter(%1, [if([t([locate(%#, ##, nP)])],[locate(%#, ##, nP)])])], )], players)]; @set %#=Dat`Barrier-Health:%q<BarrierHealth>; @eval [u(#253/func`defenseroll,[edit(%0,%b,-)],[extract(get(%L/Attacks`%#),2,1,:)])][set(%#,Dat`DR:[ceil(mul(get(%#/Dat`DR),.5))])][u(#253/func`combatresources,[u(#253/Func`CombatStamina,[edit(%0,%b,-)],%1,2,[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])],[u(#253/Func`CombatChakra,[edit(%0,%b,-)],%1,2,[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])],[u(#253/Func`CombatAP,[edit(%0,%b,-)],%1,4)])]; @include #253/func`barrierEmit=[edit(%0, %b, -)], [iter([trim(%1)], [if([t([locate(%#, ##, nP)])], [locate(%#, ##, nP)])])], 1

[sub(mul(add(words(%1),2),.8),[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])],[sub(mul(1,2),[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])]





@set %#=Dat`Barrier-Health:%q<BarrierHealth>

@eval [u(#253/func`defenseroll,[edit(%0,%b,-)],[extract(get(%L/Attacks`%#),2,1,:)])][set(%#,Dat`DR:[ceil(mul(get(%#/Dat`DR),.5))])][u(#253/func`combatresources,[u(#253/Func`CombatStamina,[edit(%0,%b,-)],%1,2,[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])],[u(#253/Func`CombatChakra,[edit(%0,%b,-)],%1,2,[u(#253/func`adaptabilitymod,[edit(%0,%b,-)])])],[u(#253/Func`CombatAP,[edit(%0,%b,-)],%1,4)])]


&FUNC`BARRIEREMIT #253=[remit(%L,%r[prompt(Combat)] [setr(!,{[ansi(hm,%N)] [IF(GTE([get(%#/Dat`Stamina`Current)],MUL([get(%#/Dat`Stamina`Max)],0.8)),[switch(rand(3),0,vigorously,1,naturally,2,effortlessly)],[IF(GTE([get(%#/Dat`Stamina`Current)],MUL([get(%#/Dat`Stamina`Max)],0.6)),[switch(rand(3),0,windedly,1,breathlessly,2,perspiringly)],[IF(GTE([get(%#/Dat`Stamina`Current)],MUL([get(%#/Dat`Stamina`max)],0.3)),[switch(rand(3),0,feeling pressured,1,showing strain,2,tiredly)],[IF(LT([get(%#/Dat`Stamina`Current)],MUL([get(%#/Dat`Stamina`Max)],0.3)),[switch(rand(3),0,with determination,1,fiercely,2,fervently)])])])])] erects a Barrier with [get(%L/Dat`BarDur`%#)] durability utilizing [art([u(#253/func`rating)])] [ansi(hg,[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),12,1,|)] [caplist(%0)])]([get(%#/dat`dr)]) against [ansi(hr,[name([extract(get(%L/Attacks`%#),1,1,:)])]'s [caplist(extract(get(%L/Attacks`%#),2,1,:))])]([extract(get(%L/Attacks`%#),4,1,:)]) [if(gt([extract(get(%L/Attacks`%#),4,1,:)],get(%#/dat`dr)),[setq(C,[add([u(#253/Func`CritMod,%0)],max(0,mul([u(#253/Func`FormMod,%0)],-3)))])][set(%L,Attacks`%#:[replace(get(%L/Attacks`%#),5,if(gte(%qC,100),[ceil(mul(mul([extract(get(%L/Attacks`%#),5,1,:)],sub(1,[add(if(match([extract(get(%L/Attacks`%#),7,1,:)],Powerful,^),add(.3,mul([u(#253/Func`EffectivenessMod,%0)],.1))),[u(#253/Func`PenMod)])])),2))],[ceil(mul([extract(get(%L/Attacks`%#),5,1,:)],sub(1,[add(if(match([extract(get(%L/Attacks`%#),7,1,:)],Powerful,^),add(.3,mul([u(#253/Func`EffectivenessMod,%0)],.1))),[u(#253/Func`PenMod)])])))]),:)])][if(gte(get(%L/Dat`BarDur`%#),[extract(get(%L/Attacks`%#),5,1,:)]),[set(%L,Dat`BarDur`%#:[max(sub(get(%L/Dat`BarDur`%#),max(sub([extract(get(%L/Attacks`%#),5,1,:)],[u(#253/Func`PotencyMod,%0)]),0)),0)])]and the Barrier endures [max(sub([extract(get(%L/Attacks`%#),5,1,:)],[u(#253/Func`PotencyMod,%0)]),0)] damage leaving it's durabiltiy at [get(%L/Dat`BarDur`%#)]. [set(%L,Attacks`%#:[replace(get(%L/Attacks`%#),5,0,:)])],recieving [if(hasattrb(%L/Dat`BarDur`%#),[set(%L,Attacks`%#:[replace(get(%L/Attacks`%#),5,[sub([extract(get(%L/Attacks`%#),5,1,:)],get(%L/Dat`BarDur`%#))],:)])][max(0,sub([extract(get(%L/Attacks`%#),5,1,:)],add(ceil(mul([u(#253/Func`PotencyMod,%0)],add(1,mul([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],.1)))),[if(and(hasattr(%#/Dat`BodyMod),match(Kaguya,[get(%#/Dat`Clan)],|)),add(mul([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Body Mod*,|)],1,|),^,1)],25),25),0)])))][if(gte(%qC,100),%b[ansi(hr,CRITICAL damage!)],%bdamage.)] The barrier has been broken![set(%L,Dat`BardDur`%#:)],[set(%L,Attacks`%#:[replace(get(%L/Attacks`%#),5,[sub([extract(get(%L/Attacks`%#),5,1,:)],get(%L/Dat`BarDur`%#))],:)])][set(%L,Dat`BardDur`%#:)][max(0,sub([extract(get(%L/Attacks`%#),5,1,:)],add(ceil(mul([u(#253/Func`PotencyMod,%0)],add(1,mul([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],.1)))),[if(and(hasattr(%#/Dat`BodyMod),match(Kaguya,[get(%#/Dat`Clan)],|)),add(mul([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Body Mod*,|)],1,|),^,1)],25),25),0)])))][if(gte(%qC,100),%b[ansi(hr,CRITICAL damage!)],%bdamage.)] The barrier has been broken!)])] [u(#253/func`Vitalitywound,[extract(get(%L/Attacks`%#),5,1,:)])] [set(%#,Dat`Vitality`Current:[max(0,sub([extract(get(%L/Attacks`%#),5,1,:)],add(ceil(mul([u(#253/Func`PotencyMod,%0)],add(1,mul([extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),2,1,|)],.1)))),[if(and(hasattr(%#/Dat`BodyMod),match(Kaguya,[get(%#/Dat`Clan)],|)),add(mul([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Body Mod*,|)],1,|),^,1)],25),25),0)])))])][If([match([extract(get(%L/Attacks`%#),7,1,:)],Disrupt,^)],[u(#253/func`Disrupt,[edit(%1,%b,-)])],)][if(match([extract(get(%L/Attacks`%#),7,1,:)],DoT,^),[u(#253/Func`DoT,%1)],)][if(match([extract(get(%L/Attacks`%#),7,1,:)],Drain,^),[u(#253/func`Drain,[edit(%1,%b,-)])],)][if(match([extract(get(%L/Attacks`%#),7,1,:)],Absorb,^),[u(#253/func`Absorb,[edit(%1,%b,-)],[extract(get(%L/Attacks`%#),1,1,:)])],)],weathering the entire attack!)][if(lt(get(%#/Dat`AP`Current),0),[set(%#,Dat`AP`Current:0)])]}, blah)]%r)]









&CMD`RESET #60=$+Reset *:@break [gte([bittype([pmatch(%#)])], 2)]={ @set [pmatch(%0)]=Dat`Vitality`Total:[u(#245/func`VitalityCalcReset,%0)]; @set [pmatch(%0)]=Dat`Vitality`Max:[u(#245/func`VitalityCalcReset,%0)]; @set [pmatch(%0)]=Dat`Vitality`Current:[get([pmatch(%0)]/Dat`Vitality`Max)]; @set [pmatch(%0)]=Dat`PhysicalEnergy`Total:[u(#245/func`PhysicalEnergyCalcReset,%0)]; @set [pmatch(%0)]=Dat`Physicalenergy`Max:[u(#245/func`PhysicalEnergyCalcReset,%0)]; @set [pmatch(%0)]=Dat`PhysicalEnergy`Current:[get([pmatch(%0)]/Dat`PhysicalEnergy`Max)]; @set [pmatch(%0)]=Dat`SpiritualEnergy`Total:[u(#245/func`SpiritualEnergyCalcReset,%0)]; @set [pmatch(%0)]=Dat`Spiritualenergy`Max:[u(#245/func`SpiritualEnergyCalcReset,%0)]; @set [pmatch(%0)]=Dat`SpiritualEnergy`Current:[get([pmatch(%0)]/Dat`SpiritualEnergy`Max)];@set [pmatch(%0)]=Dat`Stamina`Total:[u(#245/func`StaminaCalcReset,%0)];@set [pmatch(%0)]=Dat`Stamina`Max:[u(#245/func`StaminaCalcReset,%0)];@set [pmatch(%0)]=Dat`Stamina`Current:[u(#245/func`StaminaCalcReset,%0)]; @set [pmatch(%0)]=Dat`Chakra`Max:[u(#245/func`ChakraCalcReset,%0)]; @set [pmatch(%0)]=Dat`Chakra`Current:[u(#245/func`InitialChakraCalcReset,%0)]; @set [pmatch(%0)]=Dat`AP`Max:[if(and([match(get(%#/Dat`Clan),Reizei,|)],[match(get(%#/Dat`ExpertiseList),Alacrity*,|)]),[min(add(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Alacrity*,|)],1,|),^,1)],1),6),9)],6)]; @set [pmatch(%0)]=Dat`AP`Current:[get([pmatch(%0)]/Dat`AP`Max)];@set [pmatch(%0)]=Dat`Stealth`Bonus:[add([switch(after(grab(get([pmatch(%0)]/dat`expertiseList), Covert Tactics*, |), ^),0,10,1,20,2,35,10)],[extract(get([pmatch(%0)]/TransformAttribs),7,1,|)])]; @set [pmatch(%0)]=Dat`Stealth:[u(#245/Func`StealthCalcReset,%0)]; @set [pmatch(%0)]=Dat`Perception`Bonus:[add([switch(after(grab(get([pmatch(%0)]/dat`expertiseList), Observation Methods*, |), ^),0,10,1,20,2,35,10)],[extract(get([pmatch(%0)]/TransformAttribs),8,1,|)])]; @set [pmatch(%0)]=Dat`Perception:[u(#245/Func`PerceptionCalcReset,%0)];@set [pmatch(%0)]=Dat`MentalCheck`Bonus:[add([switch(after(grab(get([pmatch(%0)]/dat`expertiseList), Illusionary Tactics*, |), ^),0,10,1,20,2,35,10)],[extract(get([pmatch(%0)]/TransformAttribs),9,1,|)])]; @set [pmatch(%0)]=Dat`MentalCheck:[u(#245/Func`MentalCheckCalcReset,%0)]; @set [pmatch(%0)]=Dat`DoT:; @set [pmatch(%0)]=Dat`Link:;@pemit [pmatch(%0)]=[prompt(System)] %N has Reset your resources.;@pemit %#=[prompt(System)] You have Reset [name([pmatch(%0)])]'s resources. ;@cemit monitor-app=%n has reset [name([pmatch(%0)])]'s resources.}; @pemit [pmatch(%0)]=[prompt(Game)] You are not authorized to use the Reset command.

&FUNC`REFRESH #254=[set(%#,Dat`Vitality`Total:[u(#245/func`vitalitycalc)])] [set(%#,Dat`Vitality`Max:[get(%#/Dat`Vitality`Total)])][set(%#,Dat`PhysicalEnergy`Total:[u(#245/func`physicalenergycalc)])] [set(%#,Dat`Physicalenergy`Max:[get(%#/Dat`PhysicalEnergy`Total)])] [set(%#,Dat`PhysicalEnergy`Current:[get(%#/Dat`PhysicalEnergy`Max)])] [set(%#,Dat`SpiritualEnergy`Total:[u(#245/func`Spiritualenergycalc)])] [set(%#,Dat`Spiritualenergy`Max:[get(%#/Dat`SpiritualEnergy`Total)])] [set(%#,Dat`SpiritualEnergy`Current:[get(%#/Dat`SpiritualEnergy`Max)])] [set(%#,Dat`Stamina`Total:[u(#245/func`Staminacalc)])] [set(%#,Dat`Stamina`Max:[get(%#/Dat`Stamina`Total)])] [set(%#,Dat`Chakra`Total:[u(#245/func`chakracalc)])][set(%#,Dat`Chakra`Max:[get(%#/Dat`Chakra`Total)])][set(%#, dat`AP`max:[if(and([match(get(%#/Dat`Clan),Reizei,|)],[match(get(%#/Dat`ExpertiseList),Alacrity*,|)]),[min(add(add([after(extract(get(%#/Dat`ExpertiseList),[match(get(%#/Dat`ExpertiseList),Alacrity*,|)],1,|),^,1)],1),6),9)],6)])];@set %#=Dat`Stealth`Bonus:[add([switch(after(grab(get(%#/dat`expertiseList), Covert Tactics*, |), ^),0,10,1,20,2,35,10)],[extract(get(%#/TransformAttribs),7,1,|)])]; @set %#=Dat`Stealth:[u(#245/Func`StealthCalcReset,%#)]; @set %#=Dat`Perception`Bonus:[add([switch(after(grab(get(%#/dat`expertiseList), Observation Methods*, |), ^),0,10,1,20,2,35,10)],[extract(get(%#/TransformAttribs),8,1,|)])]; @set %#=Dat`Perception:[u(#245/Func`PerceptionCalcReset,%#)];@set %#=Dat`MentalCheck`Bonus:[add([switch(after(grab(get(%#/dat`expertiseList), Illusionary Tactics*, |), ^),0,10,1,20,2,35,10)],[extract(get(%#/TransformAttribs),9,1,|)])]; @set %#=Dat`MentalCheck:[u(#245/Func`MentalCheckCalcReset,%#)]


&FUNC`MENTALCHECKCALCRESET #245=ceil(add(get([pmatch(%0)]/Dat`MentalCheck`Bonus),mul(ADD([extract(get([pmatch(%0)]/Dat`PrimaryStats),3,1,|)],[extract(get([pmatch(%0)]/Dat`TranscendAttribs),3,1,|)],[extract(get([pmatch(%0)]/Dat`PrimaryStats),7,1,|)],[extract(get([pmatch(%0)]/Dat`TranscendAttribs),7,1,|)],[extract(get([pmatch(%0)]/Dat`PrimaryStats),8,1,|)],[extract(get([pmatch(%0)]/Dat`TranscendAttribs),8,1,|)]),add(1,fdiv(get([pmatch(%0)]/Dat`Tier),10),IF(match(get([pmatch(%0)]/Dat`Merits),Clarity,|),.2,0),IF(match(get([pmatch(%0)]/Dat`Flaws),Confusion,|),-.2,0)))))
&FUNC`MENTALCHECKCALC #245=ceil(add(get(%#/Dat`MentalCheck`Bonus),mul(ADD([extract(get(%#/Dat`PrimaryStats),3,1,|)],[extract(get(%#/Dat`TranscendAttribs),3,1,|)],[extract(get(%#/Dat`PrimaryStats),7,1,|)],[extract(get(%#/Dat`TranscendAttribs),7,1,|)],[extract(get(%#/Dat`PrimaryStats),8,1,|)],[extract(get(%#/Dat`TranscendAttribs),8,1,|)]),add(1,fdiv(get(%#/Dat`Tier),10),IF(match(get(%#/Dat`Merits),Clarity,|),.2,0),IF(match(get(%#/Dat`Flaws),Confusion,|),-.2,0)))))



&CMD`SENSE #2105=$+Sense *:@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Sense)] You are dead and can no longer Sense.%r};@assert words([setinter(lcon(%L/connect,,,1),[caplist(%0)])])={ @pemit %#=%r[prompt(System)] Please use the full name of the target(s) you wish to sense.};@assert or(match(get(%#/Dat`ExpertiseList),Extra Sensory*,|),match(get(%#/Dat`TFlist),Sharingan,|),match(get(%#/Dat`TFlist),Byakugan,|))={@pemit %#=[Prompt(Sense)] You are not Sensitive enough to attempt detect chakra. %r};@dolist/inline [setinter(lcon(%L/connect,,,1),[caplist(%0)])]={@assert match(loc(%#),loc(*##))={@pemit %#=%r[prompt(Sense)] That target is not in the same area as you. %r};@assert [u(#253/func`SenseResourceCheck)]={@pemit %#=[Prompt(Sense)] You do not have the resources to perform Sense.%r};@assert [if([member([get(%l/list`players)],%#)],gte(get(%#/Dat`AP`Current),1),1)]={@pemit %#=[Prompt(Sense)] You do not have enough AP to perform Sense.%r};@ifelse [match([extract(get(%#/Dat`PerceptionCheck),3,1,|)],pmatch(##))]={@eval [setq(1,[add(u(#253/func`PerceptionCheck,%#),[switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,5,1,15,2,25,5)])])][setq(2,[extract(get(%#/Dat`PerceptionCheck),1,1,|)])][setq(3,[rand(mul(get(pmatch(##)/Dat`Chakra`Current),[switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,.5,1,.75,2,1,.5)]),mul(get(pmatch(##)/Dat`Chakra`Current),[switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,2,1,1.5,2,1,2)]))])][if(gte(%q1,%q2),[remit(%L,[prompt(Sense)] %N has discovered [name(*##)]!)][pemit(%#,%r%t You [switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,estimate,1,sense,2,know,estimate)] [name(*##)] currently has [u(#2105/func`focus,%q3)] Chakra(%q3).)][set(%#,Dat`PerceptionCheck:)],[pemit(%#,[prompt(Sense)] [name(*##)] continues to evade your perception!)])][u(#253/FUNC`SenseRESOURCES)][u(#253/Func`Status)];},{@eval [setq(3,[rand(mul(get(pmatch(##)/Dat`Chakra`Current),[switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,.5,1,.75,2,1,.5)]),mul(get(pmatch(##)/Dat`Chakra`Current),[switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,2,1,1.5,2,1,2)]))])] [pemit(%#,%r%t You [switch(after(grab(get(%#/dat`expertiseList), Extra Sensory*, |), ^),0,estimate,1,sense,2,know,estimate)] [name(*##)] currently has [u(#2105/func`focus,%q3)] Chakra(%q3).%r)][switch(1,)][u(#253/FUNC`SenseRESOURCES)][u(#253/Func`Status)];}}



&DAT`VITALRECOVER #2103=@dolist searchng(eplayer=hasattr%(##, dat`approval%))={@break [t([match([get([loc(##)]/list`players)], ##)])];@eval [if([lt(0, [get(##/Dat`Vitality`Current)],[get(##/Dat`Vitality`Max)])], [setq(1, [sub([ceil([lmul([get(##/Dat`Vitality`Max)] .0083 [switchall(1, [hastags([loc(##)], recovery)], 3%b, [t([match([get(##/dat`ExpertiseList)], Quick Recovery*, |)])], [switch(1,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),0),1.5,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),1),3,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),2),4.5)]%b, [t([match([get(##/dat`merits)], Rapid Recovery, |)])], 1.5%b, [t([match([get(##/dat`merits)], Slow Recovery, |)])], .5%b, 1)])])], [if([hasattr(##, dat`dot)], [before([get(##/dat`dot)], |)], 0)])])][setq(2, [sub([ceil([lmul([get(##/Dat`Vitality`Total)] .00044 [switchall(1, [hastags([loc(##)], recovery)], 3%b, [t([match([get(##/dat`ExpertiseList)], Quick Recovery*, |)])], [switch(1,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),0),1.5,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),1),3,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),2),4.5)]%b, [t([match([get(##/dat`merits)], Rapid Recovery, |)])], 1.5%b, [t([match([get(##/dat`merits)], Slow Recovery, |)])], .5%b, 1)])])], [if([hasattr(##, dat`dot)], [before([get(##/dat`dot)], |)], 0)])])][if([hasattr(##, dat`dot)], [set(##, dat`dot:[if([after([get(##/dat`dot)], |)], [before([get(##/dat`dot)], |)]|[dec([after([get(##/dat`dot)], |)])])])])][pemit(##,[prompt(Game)] You have recovered [min(%q1, [sub([get(##/dat`vitality`max)], [get(##/dat`vitality`current)])])] Vitality and [min(%q2, [sub([get(##/dat`vitality`total)], [get(##/dat`vitality`max)])])] Wounds.)][set(##, Dat`Vitality`Max:[min([get(##/dat`vitality`Total)], [add([get(##/dat`vitality`Max)], %q2)])])][set(##, Dat`Vitality`Current:[min([get(##/dat`vitality`Max)], [add([get(##/dat`vitality`current)], %q1)])])])]}
&DAT`STAMINARECOVER #2103=@dolist searchng(eplayer=hasattr%(##, dat`approval%))={@break [t([match([get([loc(##)]/list`players)], ##)])];@eval [if([and([gt([get(##/dat`vitality`current)], 0)], [lt([get(##/Dat`Stamina`Current)],[get(##/Dat`Stamina`Max)])])], [setq(1, [ceil([lmul([get(##/Dat`Stamina`Max)] .0083 [switchall(1, [hastags([loc(##)], recovery)], 3%b, [t([match([get(##/dat`ExpertiseList)], Quick Recovery*, |)])], [switch(1,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),0),1.5,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),1),3,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),2),4.5)]%b, [t([match([get(##/dat`merits)], Rapid Recovery, |)])], 1.5%b, [t([match([get(##/dat`merits)], Slow Recovery, |)])], .5%b, 1)])])])][setq(2, [ceil([lmul([get(##/Dat`Stamina`Total)] .00044 [switchall(1, [hastags([loc(##)], recovery)], 3%b, [t([match([get(##/dat`ExpertiseList)], Quick Recovery*, |)])], [switch(1,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),0),1.5,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),1),3,eq(extract(extract(get(##/Dat`ExpertiseList),match(get(##/Dat`ExpertiseList),Quick Recovery*,|),1,|),2,1,^),2),4.5)]%b, [t([match([get(##/dat`merits)], Rapid Recovery, |)])], 1.5%b, [t([match([get(##/dat`merits)], Slow Recovery, |)])], .5%b, 1)])])])][pemit(##,[prompt(Game)] You have recovered [min(%q1, [sub([get(##/dat`Stamina`max)], [get(##/dat`Stamina`current)])])] Stamina and [min(%q2, [sub([get(##/dat`Stamina`Total)], [get(##/dat`Stamina`Max)])])] Wounds.)][set(##, Dat`Stamina`Max:[min([get(##/dat`Stamina`Total)], [add([get(##/dat`Stamina`Max)], %q1)])])][set(##, Dat`Stamina`Current:[min([get(##/dat`Stamina`Max)], [add([get(##/dat`Stamina`current)], %q1)])])])]}






&FUNC`TREATEMIT #2105=[remit(%L,%r[prompt(Combat)] [setr(+,{ [ansi(hm,%N)] Treats [ansi(hg,[name(*%0)]'s)] injuries for [if(lte(ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.2,1,.3,2,.4,.2)])),[sub(get([pmatch(%0)]/Dat`Vitality`Max),get([pmatch(%0)]/Dat`Vitality`Current))]),ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.2,1,.3,2,.4,.2)])),[max(0,sub(get([pmatch(%0)]/Dat`Vitality`Max),get([pmatch(%0)]/Dat`Vitality`Current)))])] Vitality and [if(lte(ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.1,1,.15,2,.2,.1)])),[sub(get([pmatch(%0)]/Dat`Vitality`Total),get([pmatch(%0)]/Dat`Vitality`Max))]),ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.1,1,.15,2,.2,.1)])),[sub(get([pmatch(%0)]/Dat`Vitality`Total),get([pmatch(%0)]/Dat`Vitality`Max))])] Vital Wounds. [if(lt(get([pmatch(%0)]/Dat`PhysicalEnergy`Current),get([pmatch(%0)]/Dat`PhysicalEnergy`Max)),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),get([pmatch(%0)]/Dat`PhysicalEnergy`Current))]),ceil(mul(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[max(0,sub(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),get([pmatch(%0)]/Dat`PhysicalEnergy`Current)))])]%bPhysical Energy and%b)][if(lt(get([pmatch(%0)]/Dat`SpiritualEnergy`Current),get([pmatch(%0)]/Dat`SpiritualEnergy`Max)),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),get([pmatch(%0)]/Dat`SpiritualEnergy`Current))]),ceil(mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[max(0,sub(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),get([pmatch(%0)]/Dat`SpiritualEnergy`Current)))])] Spiritual Energy was treated as well.)] }, blah)]%r)]


&CMD`TREATINJURY #2105=$+Treat *:@break gt(get(%#/dat`Vitality`Current),0)={@break [!member([get(%l/list`players)],%#)]={@break or(lt(get([pmatch(%0)]/Dat`Vitality`Current),get([pmatch(%0)]/Dat`Vitality`Max)),lt(get([pmatch(%0)]/Dat`Vitality`MAX),get([pmatch(%0)]/Dat`Vitality`Total)),lt(get([pmatch(%0)]/Dat`PhysicalEnergy`Current),get([pmatch(%0)]/Dat`PhysicalEnergy`Max)),lt(get([pmatch(%0)]/Dat`SpiritualEnergy`Current),get([pmatch(%0)]/Dat`SpiritualEnergy`Max)))={@break match(get(%#/Dat`ExpertiseList),Medical Knowledge*,|)={@break [u(#253/func`Healresourcecheck,[pmatch(%0)])]={@eval [u(#2105/func`TreatResources,[pmatch(%0)])][u(#2105/func`TreatEmit,%0,%0)][set([pmatch(%0)],Dat`Vitality`Current:[add(get([pmatch(%0)]/Dat`Vitality`Current),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.2,1,.3,2,.4,.2)])),[sub(get([pmatch(%0)]/Dat`Vitality`Max),get([pmatch(%0)]/Dat`Vitality`Current))]),ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.2,1,.3,2,.4,.2)])),[sub(get([pmatch(%0)]/Dat`Vitality`Max),get([pmatch(%0)]/Dat`Vitality`Current))])])])][set([pmatch(%0)],Dat`Vitality`Max:[add(get([pmatch(%0)]/Dat`Vitality`Max),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.1,1,.15,2,.2,.1)])),[sub(get([pmatch(%0)]/Dat`Vitality`Total),get([pmatch(%0)]/Dat`Vitality`Max))]),ceil(mul(get([pmatch(%0)]/Dat`Vitality`Total),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.1,1,.15,2,.2,.1)])),[sub(get([pmatch(%0)]/Dat`Vitality`Total),get([pmatch(%0)]/Dat`Vitality`Max))])])])][set([pmatch(%0)],Dat`PhysicalEnergy`Current:[add(get([pmatch(%0)]/Dat`PhysicalEnergy`Current),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),get([pmatch(%0)]/Dat`PhysicalEnergy`Current))]),ceil(mul(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`PhysicalEnergy`Max),get([pmatch(%0)]/Dat`PhysicalEnergy`Current))])])])][set([pmatch(%0)],Dat`SpiritualEnergy`Current:[add(get([pmatch(%0)]/Dat`SpiritualEnergy`Current),[if(lte(ceil(mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),get([pmatch(%0)]/Dat`SpiritualEnergy`Current))]),ceil(mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),[switch(after(grab(get(%#/dat`expertiseList), Medical Knowledge*, |), ^),0,.05,1,.075,2,.1,.05)])),[sub(get([pmatch(%0)]/Dat`SpiritualEnergy`Max),get([pmatch(%0)]/Dat`SpiritualEnergy`Current))])])])] [u(#253/Func`Status)]};@pemit %#=[Prompt(Game)] You do not have the resources to Treat that Injury.%r};@pemit %#=[Prompt(Game)] You do not know how to perform Treat Injury.%r};@pemit %#=%r[prompt(Game)] [name(*%0)] is already at fully recovered. }; @pemit %#=%r[prompt(Game)] You cannot Treat Injuries while in combat. }; @pemit %#=%r[prompt(Game)] You are dead and can no longer heal.%r