



&cmd`Control #446=$+Control *:@break [match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)]={@pemit %#=%r[prompt(Combat)] Your consciousness has been suppressed by that of [name([extract(get(%#/Dat`Control),1,1,|)])]. This prevents you from taking any action other than resisting or tensing. ;@remit %L=%r[Prompt(Combat)] Try as they might, the internal struggle over %N's consciousness remains futile under [name([extract(get(%#/Dat`Control),1,1,|)])]'s control.  };@break hasattr(%#/Dat`Exposure)={@pemit %#=%r[prompt(Combat)] Your conciousness is no longer within your body. This prevents you from taking any actions outside of tensing. ;@remit %L=%r[Prompt(Combat)] Having projected their conciousness from their body, %N remains unconcious and exposed.};@break or([match([extract(get(%#/Dat`Control),2,1,|)],Nara)],and([match([extract(get([pmatch(%1)]/Dat`Control),2,1,|)],Nara)],[match([extract(get([pmatch(%1)]/Dat`Control),1,1,|)],%#)]))={@pemit %#=%r[prompt(Combat)] You are unable to take this action while Shadow Imitation Technique is activate on this target.};@break match(%#,[pmatch(%0)])={@pemit %#=%r[prompt(Combat)] You are incapable of using this jutsu against yourself.};@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer Control others.%r};@assert [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Combat)] You are not in order.%r};@assert match(loc(%#),loc(*%0))={@pemit %#=%r[prompt(Combat)] That target is not in the same area as you. %r};@assert match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Control,|)={@pemit %#=[Prompt(Combat)] %N does not have the training to attempt this action. %r};@assert !hasattr([pmatch(%0)]/Dat`Control)={@pemit %#=%r[prompt(Combat)] [name(*%0)] is already under [if(match(extract(get([pmatch(%0)]/Dat`Control),1,1,|),%#),your,someone's)] Control.};@assert gte(get(%#/Dat`AP`Current),6)={@pemit %#=[prompt(Combat)] You do not have enough AP to perform Control.};@assert [if(match(get(%#/Dat`Clan),Nara),gte(get(%#/Dat`Chakra`Current),7500),if(match(get(%#/Dat`Clan),Yamanaka),gte(get(%#/Dat`Chakra`Current),10000),gte(get(%#/Dat`Chakra`Current),5000)))]={@pemit %#=[prompt(Combat)] You do not have enough Chakra to perform Control.}; @dolist/inline %0={@eval [u(#253/func`InitiateCheck,##)] }; @eval   [switch(1,[match(get(%#/Dat`Clan),Nara)],[set(%#,Dat`Chakra`Current:[sub(get(%#/Dat`Chakra`Current),7500)])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])],[match(get(%#/Dat`Clan),Yamanaka)],[set(%#,Dat`Chakra`Current:[sub(get(%#/Dat`Chakra`Current),10000)])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])],[and(!match(get(%#/Dat`Clan),Nara),!match(get(%#/Dat`Clan),Yamanaka))],[set(%#,Dat`Chakra`Current:[sub(get(%#/Dat`Chakra`Current),5000)])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])])];@IF and([match(get(%#/Dat`ExpertiseList),Control*,|)],[match(get(%#/Dat`Clan),Nara)])={@eval [if(gte([u(#253/func`StealthCheck,%#,Ninjutsu)],[u(#253/func`PerceptionCheck,[pmatch(%0)])]),[set([pmatch(%0)],Dat`Control:%#|Nara)][remit(%L,[prompt(Combat)] %N extends their shadow%, cleverly weaving and winding it through the area until it makes contact with [name(*%0)]'s shadow%, capturing them with the Hiden Jutsu: Shadow Imitation Technique!)],[remit(%L,[prompt(Combat)] Despite %N's efforts%, they are unable to capture [name(*%0)] with the Hiden Jutsu: Shadow Imitation Technique.)])] [u(#253/Func`Status)]};@IF and([match(get(%#/Dat`ExpertiseList),Control*,|)],[match(get(%#/Dat`Clan),Yamanaka)])={@eval [if(and(gte([u(#253/func`StealthCheck,%#,Ninjutsu)],[u(#253/func`PerceptionCheck,[pmatch(%0)])]),gte([u(#253/func`MentalCheck,%#)],[u(#253/func`MentalCheck,[pmatch(%0)])])) ,[set([pmatch(%0)],Dat`Control:%#|Yamanaka)][set(%#,Dat`Exposure:[pmatch(%0)]|3|1)][remit(%L,[prompt(Combat)] %N forms the tell tale hand sign for the Hiden Jutsu: Mind Body Switch Technique%, lining up their target and projecting their consciousness in to [name(*%0)]'s body successfully!)],[remit(%L,[prompt(Combat)] %N forms the tell tale hand sign for the Hiden Jutsu: Mind Body Switch Technique%, lining up their target and projecting their consciousness towards [name(*%0)]%, but they fail to make contact which leaves them exposed!)][set(%#,Dat`Exposure:[pmatch(%0)]|3|0)])] [u(#253/Func`Status)] };@IF and([match(get(%#/Dat`ExpertiseList),Control*,|)],[!match(get(%#/Dat`Clan),Yamanaka)],[!match(get(%#/Dat`Clan),Nara)])={@eval [if(gte([u(#253/func`MentalCheck,%#)],[u(#253/func`MentalCheck,[pmatch(%0)])]),[set([pmatch(%0)],Dat`Control:%#|General)][switch(1,[match(get(%#/Dat`TF),Sharingan)],[remit(%L,[prompt(Combat)] %N's sharingan seems to flare upon [name(*%0)] intensely%, suddenly taking influence over their mind.)],[match(get(%#/Dat`TF),Kokuuzou)],[remit(%L,[prompt(Combat)] %N's void-like gaze seems to draw [name(*%0)]'s mind in to nothingness influence is taken over their physical form.)],[nor([match(get(%#/Dat`TF),Sharingan)],[match(get(%#/Dat`TF),Kokuuzou)])],[remit(%L,[prompt(Combat)] %N imposes their will upon [name(*%0)]%, seizing influence over their mind.)])],[remit(%L,[prompt(Combat)] %N attempts to seize control over [name(*%0)]'s mind%, but they ultimately fail.)])] [u(#253/Func`Status)] }     
exposure

&Cmd`Resist #446=$+Resist:@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer Resist others.%r};@assert [member([get(%l/list`players)],%#)]={@pemit %#=%r[prompt(Combat)] You are not in order.};@assert gt(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.1)),2500)])={@pemit %#=%r[prompt(Combat)] You do not have enough Chakra to Resist the control over you.};@assert hasattr(%#/Dat`Control)={@remit %L=[prompt(Combat)] %N appears to be straining themselves very hard for some entirely unexplainable reason.%r; @set %#=Dat`Chakra`Current:[max([sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.1)),2500)])],0)] ; @Eval [u(#253/Func`Status)]}; @assert eq([get(%L/player_turn)], [member([get(%L/list`players)], %#)])={@pemit %#=%r[prompt(Combat)] It is not your turn.%r};@assert gte(get(%#/Dat`AP`Current),6)={@pemit %#=[prompt(Combat)] You do not have enough AP to perform Control.};@eval [switch(1,[match([extract(get(%#/Dat`Control),2,1,|)],Nara)],[if(gte([u(#245/Func`ChakraChallenge,%#)],[u(#245/Func`ChakraChallenge,[extract(get(%#/Dat`Control),1,1,|)])]),[remit(%L,[prompt(Combat)] %N struggles against the hold of [name([extract(get(%#/Dat`Control),1,1,|)])]'s Shadow Imitation Technique%, eventually powering through the hold and releasing themselves from the jutsu!)][set([extract(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Control),1,1,|)],Dat`Chakra`Current:[max(0,Sub(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),[max(ceil(mul(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])][set(%#,Dat`Control:)],[remit(%L,[prompt(Combat)] %N struggles against the hold that [name([extract(get(%#/Dat`Control),1,1,|)])]'s Shadow Imitation Technique has on them%, but ultimately they fail to break free.)][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])],[match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)],[if(gte([u(#245/Func`ChakraChallenge,%#)],[u(#245/Func`ChakraChallenge,[extract(get(%#/Dat`Control),1,1,|)])]),[remit(%L,[prompt(Combat)] %N struggles against the presence of [name([extract(get(%#/Dat`Control),1,1,|)])] and their Mind Body Switch%, eventually powering through the hold and releasing themselves from the jutsu!)][set([extract(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Control),1,1,|)],Dat`Chakra`Current:[max(0,Sub(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),[max(ceil(mul(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])][wipe([extract(get(%#/Dat`Control),1,1,|)]/Dat`Exposure)][set(%#,Dat`Control:)],[remit(%L,[prompt(Combat)] %N struggles against the hold that [name([extract(get(%#/Dat`Control),1,1,|)])]'s Mind Body Switch has on them%, but ultimately they fail to break free.)][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])])],[match([extract(get(%#/Dat`Control),2,1,|)],General)],[if(gte([u(#245/Func`ChakraChallenge,%#)],[u(#245/Func`ChakraChallenge,[extract(get(%#/Dat`Control),1,1,|)])]),[remit(%L,[prompt(Combat)] %N struggles against the Control [name([extract(get(%#/Dat`Control),1,1,|)])] exudes upon them%, eventually powering through the hold and releasing themselves from the jutsu!)][set([extract(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Control),1,1,|)],Dat`Chakra`Current:[max(0,Sub(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),[max(ceil(mul(get([extract(get(%#/Dat`Control),1,1,|)]/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])][set(%#,Dat`Control:)],[remit(%L,[prompt(Combat)] %N struggles against the hold that [name([extract(get(%#/Dat`Control),1,1,|)])]'s Control has on them%, but ultimately they fail to break free.)][set(%#,Dat`AP`Current:[max(sub(get(%#/Dat`AP`Current),6),0)])][set(%#,Dat`Chakra`Current:[max(0,Sub(get(%#/Dat`Chakra`Current),[max(ceil(mul(get(%#/Dat`Chakra`Current),.01)),2500)]))])])])] [u(#253/Func`Status)]

&Cmd`Release #446=$+Release *:@break match(%#,[pmatch(%0)])={@pemit %#=%r[prompt(Combat)] You are incapable of using this jutsu against yourself.};@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer Release others from Control.%r};@assert [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Combat)] You are not in order.%r};@assert match(loc(%#),loc(*%0))={@pemit %#=%r[prompt(Combat)] That target is not in the same area as you. %r};@assert match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Control,|)={@pemit %#=[Prompt(Combat)] %N does not have the training to attempt this action. %r};@assert match([extract(get([pmatch(%0)]/Dat`Control),1,1,|)],%#)={@pemit %#=%r[prompt(Combat)] [name(*%0)] is not under your Control.}; @remit %L=%r[Prompt(Combat)] %N has released [name(*%0)] from their control.;@set %#=Dat`Exposure: ;@set [pmatch(%0)]=Dat`Control:

&Cmd`ShadowAttack #446=$+Shadow *=*:@break [match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)]={@pemit %#=%r[prompt(Combat)] Your consciousness has been suppressed by that of [name([extract(get(%#/Dat`Control),1,1,|)])]. This prevents you from taking any action other than resisting or tensing. ;@remit %L=%r[Prompt(Combat)] Try as they might, the internal struggle over %N's consciousness remains futile under [name([extract(get(%#/Dat`Control),1,1,|)])]'s control.  }; @break match(%#,[pmatch(%1)])={@pemit %#=%r[prompt(Combat)] You are incapable of using this jutsu against yourself.};@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer utilize Shadows against others.%r};@assert [member([get(%l/list`players)],%#)]={@pemit %#=%r%r[prompt(Combat)] You are not in order.%r};@assert match(loc(%#),%L))={@pemit %#=%r[prompt(Combat)] That target is not in the same area as you. %r};@assert match([regeditall(get(%#/dat`ExpertiseList), %\^%[012%],)],Control,|)={@pemit %#=[Prompt(Combat)] %N does not have the training to attempt this action. %r};@assert match([extract(get([pmatch(%1)]/Dat`Control),1,1,|)],%#)={@pemit %#=%r[prompt(Combat)] [name(*%1)] is not under your Control.};@assert and([match([extract(get([pmatch(%1)]/Dat`Control),2,1,|)],Nara)],[match([extract(get([pmatch(%1)]/Dat`Control),1,1,|)],%#)])={@pemit %#=[Prompt(Combat)] You do not have Shadow Imitation Technique applied to [name(*%1)].};@assert gt(get(%#/Dat`Chakra`Current),2500)={@pemit %#=%r[prompt(Combat)] You do not have enough Chakra to utilize Shadows against others.};@assert gte(get(%#/Dat`AP`Current),4)={@pemit %#=[prompt(Combat)] You do not have enough AP to perform a Shadow Manipulation attack.};@set %#=Dat`AP`Current:[max(sub(Get(%#/Dat`AP`Current),4),0)] ;@eval [setq(0,[rand([ceil(mul([mul(add([extract(get(%#/Dat`Primarystats),2,1,|)],[extract(get(%#/Dat`TranscendAttribs),2,1,|)],[extract(get(%#/Dat`Primarystats),8,1,|)],[extract(get(%#/Dat`TranscendAttribs),8,1,|)],[extract(get(%#/Dat`Primarystats),7,1,|)],[extract(get(%#/Dat`TranscendAttribs),7,1,|)]),80)],.25))],[ceil([mul(add([extract(get(%#/Dat`Primarystats),2,1,|)],[extract(get(%#/Dat`TranscendAttribs),2,1,|)],[extract(get(%#/Dat`Primarystats),8,1,|)],[extract(get(%#/Dat`TranscendAttribs),8,1,|)],[extract(get(%#/Dat`Primarystats),7,1,|)],[extract(get(%#/Dat`TranscendAttribs),7,1,|)]),80)])])])] ;@IF gte([u(#245/Func`ChakraChallenge,%#)],[u(#245/Func`ChakraChallenge,[pmatch(%1)])])={@remit %L=%r[Prompt(Combat)] %N attacks with [poss(%#)] shadow in the form of [caplist(%0,,,L)] against [name(*%1)]%, hitting them for %q0 damage!; @set [pmatch(%1)]=Dat`Vitality`Current:[max(sub(get([pmatch(%1)]/Dat`Vitality`Current),%q0),0)]; @wait .01=@eval [u(#253/Func`Status)]},{@remit %L=%r[Prompt(Combat)] %N attacks with [poss(%#)] shadow in the form of [caplist(%0,,,L)] against [name(*%1)]%, but their resistance proves too much to do any harm.}


&CMD`MBSATTACK #446=$+MBS */*=*:@assert and([match([extract(get([pmatch(%1)]/Dat`Control),2,1,|)],Yamanaka)],[match([extract(get([pmatch(%1)]/Dat`Control),1,1,|)],%#)])={@pemit %#=%r[prompt(Combat)] You are not currently in control of [name(*%1)]'s Body.};@break [match([extract(get(%#/Dat`Control),2,1,|)],Yamanaka)]={@pemit %#=%r[prompt(Combat)] Your consciousness has been suppressed by that of [name([extract(get(%#/Dat`Control),1,1,|)])]. This prevents you from taking any action other than resisting or tensing. ;@remit %L=%r[Prompt(Combat)] Try as they might, the internal struggle over %N's consciousness remains futile under [name([extract(get(%#/Dat`Control),1,1,|)])]'s control.  };@break hasattr(%#/Dat`Exposure)={@pemit %#=%r[prompt(Combat)] Your conciousness is no longer within your body. This prevents you from taking any actions outside of tensing. ;@remit %L=%r[Prompt(Combat)] Having projected their conciousness from their body, %N remains unconcious and exposed.};@break or([match([extract(get(%#/Dat`Control),2,1,|)],Nara)],and([match([extract(get([pmatch(%1)]/Dat`Control),2,1,|)],Nara)],[match([extract(get([pmatch(%1)]/Dat`Control),1,1,|)],%#)]))={@pemit %#=%r[prompt(Combat)] You are unable to take this action while Shadow Imitation Technique is activate on this target.};@break if(gte(bittype(%#),5),0,match(%#,[pmatch(%1)]))={@pemit %#=%r[prompt(Combat)] You incapable of using this jutsu against yourself.};@assert gt(get(%#/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] You are dead and can no longer make your target attack.%r};@assert gt(get([pmatch(%1)]/dat`Vitality`Current),0)={@pemit %#=%r[prompt(Combat)] They are dead and can no longer be made to attack.%r};@assert or(match([sqlite_query(Game, Select Method From Templates where ID=[extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Attack),match([sqlite_query(Game, Select Method From Templates where ID=[extract(get(%#/Dat`CopiedJutsu`[edit(%0,%b,-)]),7,1,|)])],Attack))={@pemit %#=[prompt(Combat)] The [caplist(%0,,,L)] jutsu is not capable of Attacking.};@assert lte(words(%2),add([switch([sqlite_query(Game, Select Category From Templates where ID=[extract(get(%#/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Taijutsu,3,Ninjutsu,[if(match(get([pmatch(%1)]/Dat`ExpertiseList),Shape Transformation*,|),2,0)])],1))={@pemit %#=%r[prompt(Combat)] You cannot target that many opponents at once.};@assert [member([get(%L/list`players)],%#)]={@pemit %#=%r%r[prompt(Combat)] You are not in order.%r};@assert eq([get(%L/player_turn)], [member([get(%L/list`players)], %#)])={@pemit %#=%r[prompt(Combat)] It is not your turn.%r};@break if(match(extract(get([pmatch(%1)]/Dat`PerceptionCheck),3,1,|),[pmatch(%2)]),1,0)={@pemit %#=%r[prompt(Combat)] [name(*%2)] is no where to be found by your controlled target: [name([pmatch(%1)])].};@dolist/inline %2={@assert nearby(%#,[pmatch(##)])={@pemit %#=%r[prompt(Combat)] A target is not in the same area as you. %r}};@assert or(hasattr([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),hasattr(%#/Dat`CopiedJutsu`[edit(%0,%b,-)]))={@pemit %#=[Prompt(Combat)] Your controlled target [name([pmatch(%1)])] does not know how to perform [caplist(%0,,,L)].};@assert [u(#253/func`Cresourcecheck,%0,%2,,%1)]={@pemit %#=[Prompt(Combat)] Your controlled target [name([pmatch(%1)])] does not have the resources to perform [caplist(%0,,,L)].%r};@assert gte(get([pmatch(%1)]/Dat`AP`Current),[u(#253/Func`CombatAP,[edit(%0,%b,-)],%2,0)])={@pemit %#=[Prompt(Combat)] Your controlled target [name([pmatch(%1)])] does not have enough AP to perform [caplist(%0,,,L)].%r};@eval [u(#253/func`ccombatresources,%1,[u(#253/Func`CCombatStamina,[edit(%0,%b,-)],%2,1,,%1)],[u(#253/Func`CCombatChakra,[edit(%0,%b,-)],%2,1,,%1)],[u(#253/Func`CCombatAP,[edit(%0,%b,-)],%2,0,%1)])] ;@dolist/inline %2={@eval [set([pmatch(%1)],Dat`AR:[u(#253/func`attackroll,%0)])][set([pmatch(%1)],Dat`Damage:[u(#253/func`damageroll,%0)])][set(%L,Attacks`[pmatch(##)]:[insert([get(%L/Attacks`[pmatch(##)])],-1,[pmatch(%1)]:%0:##:[get([pmatch(%1)]/Dat`AR)]:[get([pmatch(%1)]/Dat`Damage)]:0,^)])][u(#253/func`Cattackemit,%0,##,%1)][u(#253/Func`CStatus,%1)]}


&CMD`MBSSHEET #60=$+MBSSheet: @assert [strmatch([get(%#/dat`clan)], Yamanaka)]={@pemit %#=[prompt(Game)] You are not permitted to use this command.}; @assert [and([hasattr(%#, dat`exposure)], [elements([get(%#/dat`exposure)], 3, |)])]={@pemit %#=[prompt(game)] You do not have anyone under your Control.}; @eval [setq(0, [elements([get(%#/dat`exposure)], 1, |)])]; @pemit %#=[printf($^78:[ansi(hb,-=)]:s, %[ [ansi(hw, [cname(%q0)]'s Sheet)] %])]%r[printf($^24s $^27s $^24s,Clan: [get(%q0/dat`clan)], Ninja Tier: [u(#2082/func`staffshinobirank,%0)],Stat Tier: [get(%q0/dat`tier)])]%r[repeat([ansi(hb,-)],78)]%r[u(#594/fn`stats,%q0)]%r[u(#594/fn`attacks, %q0)]%r[u(#594/fn`defenses, %q0)]%r[u(#594/fn`transforms, %q0)]%r[u(#594/fn`RPskills, %q0)]%r[repeat([ansi(hb,-=)],39)]


[u(#253/func`combatresources,[u(#253/Func`CombatStamina,[edit(%0,%b,-)],%2,1)],[u(#253/Func`CombatChakra,[edit(%0,%b,-)],%2,1)],[u(#253/Func`CombatAP,[edit(%0,%b,-)],%2,0)])][u(#253/func`attackemit,%0,##)][u(#253/Func`Status)]

&FUNC`CCOMBATRESOURCES #253=[set([pmatch(%0)],Dat`AP`Current:[sub(get([pmatch(%0)]/Dat`AP`Current),%3)])] [set([pmatch(%0)],Dat`Stamina`Current:[sub(get([pmatch(%0)]/Dat`Stamina`Current),%1)])] [set([pmatch(%0)],Dat`Chakra`Current:[sub(get([pmatch(%0)]/Dat`Chakra`Current),%2)])]
&FUNC`CCOMBATSTAMINA #253=[ceil(mul(mul(Sub([sqlite_query(Game, Select Stamina From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],mul([sqlite_query(Game, Select Stamina From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],[u(#253/func`efficiencymod,[edit(%0,%b,-)])])),[if(hasattr([pmatch(%4)]/Dat`Link),2,1)]),[if(gt(words(%1),1),[sub(mul(add(words(%1),%2),.8),%3)],[sub(mul(1,%2),%3)])]))]
&FUNC`CCOMBATCHAKRA #253=[ceil(mul(mul(Sub([sqlite_query(Game, Select Chakra From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],mul([sqlite_query(Game, Select Chakra From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],[u(#253/func`efficiencymod,[edit(%0,%b,-)])])),[if(hasattr([pmatch(%4)]/Dat`Link),2,1)]),[if(gt(words(%1),1),[sub(mul(add(words(%1),%2),.8),%3)],[sub(mul(1,%2),%3)])]))]
&FUNC`CCOMBATAP #253=[max([switch([sqlite_query(Game, Select Method From Templates where ID=[extract(get([pmatch(%3)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Attack,[switch([sqlite_query(Game, Select Category From Templates where ID=[extract(get([pmatch(%3)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],Taijutsu,[switch([sqlite_query(Game, Select Rank From Templates where ID=[extract(get([pmatch(%3)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],E,1,D,1,C,2,B,2,A,3,S,3)],Ninjutsu,[switch([sqlite_query(Game, Select Rank From Templates where ID=[extract(get([pmatch(%3)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],E,1,D,2,C,3,B,3,A,4,S,4)])],Defend,0)],[ceil(add([sqlite_query(Game, Select AP From Templates where ID=[extract(get([pmatch(%3)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],add([u(#253/func`Cformmod,[edit(%0,%b,-)],%3)],[if([extract(get([pmatch(%3)]/Dat`Link),2,1,|)],1)][if(gt(words(%1),1),mul(words(%1),.8))],[sub(%2,mul(%2,[u(#253/func`Cadaptabilitymod,[edit(%0,%b,-)],%3)]))])))])]
&FUNC`CATTACKEMIT #253=[remit(%L,%r[prompt(Combat)] [setr(!,{[ansi(hm,%N)] forces [name(*%2)] to [IF(GTE([get([pmatch(%2)]/Dat`Stamina`Current)],MUL([get([pmatch(%2)]/Dat`Stamina`Max)],0.8)),[switch(rand(3),0,vigorously,1,naturally,2,effortlessly)],[IF(GTE([get([pmatch(%2)]/Dat`Stamina`Current)],MUL([get([pmatch(%2)]/Dat`Stamina`Max)],0.6)),[switch(rand(3),0,windedly,1,breathlessly,2,perspiringly)],[IF(GTE([get([pmatch(%2)]/Dat`Stamina`Current)],MUL([get([pmatch(%2)]/Dat`Stamina`max)],0.3)),[switch(rand(3),0,feeling pressured,1,showing strain,2,tiredly)],[IF(LT([get([pmatch(%2)]/Dat`Stamina`Current)],MUL([get([pmatch(%2)]/Dat`Stamina`Max)],0.3)),[switch(rand(3),0,with determination,1,fiercely,2,fervently)])])])])] attack with [art([u(#253/func`rating)])], [if(gt(words(sqlite_query(Game, Select Range from Templates where ID="[extract(get([pmatch(%2)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]")),1),multi,[lcstr(sqlite_query(Game, Select Range from Templates where ID="[extract(get([pmatch(%2)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)]"))])]-ranged [ansi(hg,[extract(get([pmatch(%2)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),12,1,|)] [caplist(%0)])]([get([pmatch(%2)]/dat`ar)]) against [ansi(hr,[name(*%1)])].}, blah)]%r)]
&FUNC`CSTATUS #253=[set([pmatch(%0)],Dat`Stamina`Max:[u(#245/func`staminacalc,[pmatch(%0)])])][set([pmatch(%0)],Dat`Chakra`Max:[u(#245/func`Chakracalc,[pmatch(%0)])])][if(gt([get([pmatch(%0)]/dat`Vitality`Current)],[get([pmatch(%0)]/dat`Vitality`Max)]),[set([pmatch(%0)],Dat`Vitality`Current:[get([pmatch(%0)]/dat`Vitality`Max)])])][if(gt([get([pmatch(%0)]/dat`Stamina`Current)],[get([pmatch(%0)]/dat`Stamina`Max)]),[set([pmatch(%0)],Dat`Stamina`Current:[get([pmatch(%0)]/dat`Stamina`Max)])])][if(gt([get([pmatch(%0)]/dat`Chakra`Current)],[get([pmatch(%0)]/dat`Chakra`Max)]),[set([pmatch(%0)],Dat`Chakra`Current:[get([pmatch(%0)]/dat`Chakra`Max)])])][pemit([pmatch(%0)],[prompt(Combat)] [ansi(hr,Vit)]:[ansi(hw,[get([pmatch(%0)]/dat`Vitality`Current)])]|[ansi(hr,[get([pmatch(%0)]/dat`Vitality`Max)])] [ansi(hg,Stam)]:[ansi(hw,[get([pmatch(%0)]/dat`stamina`Current)])]|[ansi(hg,[get([pmatch(%0)]/dat`Stamina`Max)])] [ansi(hc,Chakra)]:[ansi(hw,[get([pmatch(%0)]/dat`chakra`Current)])]|[ansi(hc,[get([pmatch(%0)]/dat`Chakra`Max)])] [ansi(hy,AP)]:[ansi(hw,[get([pmatch(%0)]/dat`AP`Current)])]|[ansi(hy,[get([pmatch(%0)]/dat`AP`Max)])]%r%t[ansi(y,Current Stance)]: [ansi(hy,[get([pmatch(%0)]/Dat`Stance)])] %r)]
&FUNC`CRESOURCECHECK #253=and(gte(get([pmatch(%4)]/Dat`Stamina`Current),ceil(mul(mul(Sub([sqlite_query(Game, Select Stamina From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],mul([sqlite_query(Game, Select Stamina From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],[u(#253/func`efficiencymod,[edit(%0,%b,-)])])),[if(hasattr([pmatch(%4)]/Dat`Link),2,1)]),[if(gt(words(%1),1),[sub(mul(add(words(%1),%2),.5),%3)],[sub(mul(1,%2),%3)])]))),gte(get([pmatch(%4)]/Dat`Chakra`Current),ceil(mul(mul(Sub([sqlite_query(Game, Select Chakra From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],mul([sqlite_query(Game, Select Chakra From Templates where ID=[extract(get([pmatch(%4)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),7,1,|)])],[u(#253/func`efficiencymod,[edit(%0,%b,-)])])),[if(hasattr([pmatch(%4)]/Dat`Link),2,1)]),[if(gt(words(%1),1),[sub(mul(add(words(%1),%2),.5),%3)],[sub(mul(1,%2),%3)])]))))
&FUNC`STAMINACALC #245=[if(t(%0),[ceil(MUL(ADD(MUL(get([pmatch(%0)]/Dat`PhysicalEnergy`Current),1.2),mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Current),.3)),IF(match(get([pmatch(%0)]/Dat`Merits),Vigorous,|),1,[IF(match(get([pmatch(%0)]/Dat`Flaws),Enervated,|),1,1)])))],[ceil(MUL(ADD(MUL(get(%#/Dat`PhysicalEnergy`Current),1.2),mul(get(%#/Dat`SpiritualEnergy`Current),.3)),IF(match(get(%#/Dat`Merits),Vigorous,|),1,[IF(match(get(%#/Dat`Flaws),Enervated,|),1,1)])))])]
&FUNC`CHAKRACALC #245=[if(t(%0), [ceil(MUL(ADD(MUL(get([pmatch(%0)]/Dat`PhysicalEnergy`Current),.3),mul(get([pmatch(%0)]/Dat`SpiritualEnergy`Current),1.2)),IF(match(get([pmatch(%0)]/Dat`Merits),High Chakra,|),3,IF(match(get([pmatch(%0)]/Dat`Flaws),Low Chakra,|),1.5,2))))], [ceil(MUL(ADD(MUL(get(%#/Dat`PhysicalEnergy`Current),.3),mul(get(%#/Dat`SpiritualEnergy`Current),1.2)),IF(match(get(%#/Dat`Merits),High Chakra,|),3,IF(match(get(%#/Dat`Flaws),Low Chakra,|),1.5,2))))])]
&FUNC`CFORMMOD #253=CEIL(fDiv(ADD(MUL(add([extract(get([pmatch(%1)]/Dat`TranscendAttribs),5,1,|)],[extract(get([pmatch(%1)]/Dat`PrimaryStats),5,1,|)]),0.25),MUL(MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),3,1,|)],IF(GTE([get([pmatch(%1)]/Dat`PhysicalEnergy`Current)],MUL([get([pmatch(%1)]/Dat`PhysicalEnergy`Total)],0.75)),1.25,IF(GTE([get([pmatch(%1)]/Dat`PhysicalEnergy`Current)],MUL([get([pmatch(%1)]/Dat`PhysicalEnergy`Total)],0.5)),1,0.75))),IF(hasattr([pmatch(%1)]/Dat`TF),IF(Match([sqlite_query(Game, Select Form From Transformations Where Name="[get([pmatch(%1)]/Dat`TF)]")],Yes),1.25,.75),1)),0.4)),-1))
&FUNC`CADAPTABILITYMOD #253=round(ADD(MUL(.075,MUL(MUL(MUL([extract(get([pmatch(%1)]/Dat`JutsuAttributes`[edit(%0,%b,-)]),6,1,|)],IF(GTE(get([pmatch(%1)]/Dat`SpiritualEnergy`Current),MUL(get([pmatch(%1)]/Dat`SpiritualEnergy`Total),0.75)),1.25,IF(GTE(get([pmatch(%1)]/Dat`SpiritualEnergy`Current),MUL(get([pmatch(%1)]/Dat`SpiritualEnergy`Total),0.5)),1,0.75))),IF(hasattr([pmatch(%1)]/Dat`TF),IF(match([sqlite_query(Game, Select Adaptability From Transformations Where Name="[get([pmatch(%1)]/Dat`TF)]")],Yes),1.5,.75),1)),0.5)),MUL(ADD([extract(get([pmatch(%1)]/Dat`PrimaryStats),8,1,|)],[extract(get([pmatch(%1)]/Dat`TranscendAttribs),8,1,|)]),0.01)),2)



[u(#594/fn`stats, get(%#/dat`control))]%r[u(#594/fn`attacks, get(%#/dat`control))]%r[u(#594/fn`defenses, get(%#/dat`control))]%r[u(#594/fn`RPskills, get(%#/dat`control))]



[setq(1,[u(#253/func`MentalCheck,%#)])][setq(2,[u(#253/func`MentalCheck,pmatch(%0))])] 
[setq(1,[u(#253/func`StealthCheck,%#,%0)])][setq(2,[u(#253/func`PerceptionCheck,[pmatch(##)])])] 

&FUNC`STEALTHCHECK #253=ceil(mul(mul(rand(mul([u(#245/func`StealthChallenge,%0,%1)],.6),add([u(#245/func`StealthChallenge,%0,%1)],10)),IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select Perception From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.25,.75),1)),[if(match([extract(get(%#/Dat`Control),2,1,|)],General,|),.25,1)]))
&FUNC`PERCEPTIONCHECK #253=ceil(mul(mul(rand(mul([u(#245/func`Perceptionchallenge,%0)],.6),add([u(#245/func`Perceptionchallenge,%0)],10)),IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select Perception From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.25,.75),1)),[if(match([extract(get(%#/Dat`Control),2,1,|)],General,|),.25,1)]))
&FUNC`MENTALCHECK #253=ceil(mul(mul(rand(mul([u(#245/func`mentalchallenge,%0)],.6),add([u(#245/func`mentalchallenge,%0)],10)),IF(hasattr(%#/Dat`TF),IF(match([sqlite_query(Game, Select Mental From Transformations Where Name="[get(%#/Dat`TF)]")],Yes),1.25,.75),1)),[if(match([extract(get(%#/Dat`Control),2,1,|)],General,|),.25,1)]))


&FUNC`ChakraCHALLENGE #245=ceil(mul(ADD([extract(get(%0/Dat`PrimaryStats),2,1,|)],[extract(get(%0/Dat`TranscendAttribs),2,1,|)],[extract(get(%0/Dat`PrimaryStats),7,1,|)],[extract(get(%0/Dat`TranscendAttribs),7,1,|)],[extract(get(%0/Dat`PrimaryStats),8,1,|)],[extract(get(%0/Dat`TranscendAttribs),8,1,|)],get(%0/Dat`MentalCheck`Bonus)),add(1,fdiv(get(%0/Dat`Tier),10),IF(match(get(%0/Dat`Merits),Perfected Chakra Molding,|),.1,0),IF(match(get(%0/Dat`Flaws),Erratic Chakra,|),-.1,0))))



